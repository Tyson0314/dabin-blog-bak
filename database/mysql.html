<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>程序员大彬</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <script>
			var _hmt = _hmt || [];
			(function() {
				var hm = document.createElement("script");
				hm.src = "https://hm.baidu.com/hm.js?f9b36644dd9e756e508a77f272a63e07";
				var s = document.getElementsByTagName("script")[0];
				s.parentNode.insertBefore(hm, s);
			})();
		</script>
    <meta name="description" content="自学转码之路">
    <meta name="baidu-site-verification" content="code-mtJaPDeFwy">
    
    <link rel="preload" href="/assets/css/0.styles.b00f5641.css" as="style"><link rel="preload" href="/assets/js/app.8b2696d1.js" as="script"><link rel="preload" href="/assets/js/2.d0db0f62.js" as="script"><link rel="preload" href="/assets/js/35.4a8cdbbc.js" as="script"><link rel="preload" href="/assets/js/4.23f6297f.js" as="script"><link rel="preload" href="/assets/js/3.1924df35.js" as="script"><link rel="prefetch" href="/assets/js/10.b9d2c267.js"><link rel="prefetch" href="/assets/js/11.a9536795.js"><link rel="prefetch" href="/assets/js/12.637e3c09.js"><link rel="prefetch" href="/assets/js/13.102d093f.js"><link rel="prefetch" href="/assets/js/14.d7307789.js"><link rel="prefetch" href="/assets/js/15.18bb96a8.js"><link rel="prefetch" href="/assets/js/16.1b890605.js"><link rel="prefetch" href="/assets/js/17.25ef6a92.js"><link rel="prefetch" href="/assets/js/18.fa185cc7.js"><link rel="prefetch" href="/assets/js/19.499be2f4.js"><link rel="prefetch" href="/assets/js/20.08f6b86d.js"><link rel="prefetch" href="/assets/js/21.40cb96ce.js"><link rel="prefetch" href="/assets/js/22.2c42b78a.js"><link rel="prefetch" href="/assets/js/23.15469153.js"><link rel="prefetch" href="/assets/js/24.7f6b0e2a.js"><link rel="prefetch" href="/assets/js/25.cbd85eeb.js"><link rel="prefetch" href="/assets/js/26.1ad15ebe.js"><link rel="prefetch" href="/assets/js/27.4eba854b.js"><link rel="prefetch" href="/assets/js/28.e509fb9b.js"><link rel="prefetch" href="/assets/js/29.994dbd5a.js"><link rel="prefetch" href="/assets/js/30.18c1aefb.js"><link rel="prefetch" href="/assets/js/31.c38796f9.js"><link rel="prefetch" href="/assets/js/32.88ef97b8.js"><link rel="prefetch" href="/assets/js/33.a4dfb656.js"><link rel="prefetch" href="/assets/js/34.6de68068.js"><link rel="prefetch" href="/assets/js/36.0e932c72.js"><link rel="prefetch" href="/assets/js/37.38759ff6.js"><link rel="prefetch" href="/assets/js/38.d822e272.js"><link rel="prefetch" href="/assets/js/39.de685084.js"><link rel="prefetch" href="/assets/js/40.ad41558b.js"><link rel="prefetch" href="/assets/js/41.b01fca4f.js"><link rel="prefetch" href="/assets/js/42.c1253a77.js"><link rel="prefetch" href="/assets/js/43.d2f61e81.js"><link rel="prefetch" href="/assets/js/44.9d432355.js"><link rel="prefetch" href="/assets/js/45.0418c1c2.js"><link rel="prefetch" href="/assets/js/46.184f9783.js"><link rel="prefetch" href="/assets/js/47.569f10e6.js"><link rel="prefetch" href="/assets/js/48.c1409476.js"><link rel="prefetch" href="/assets/js/49.6ad0d80a.js"><link rel="prefetch" href="/assets/js/5.3354b992.js"><link rel="prefetch" href="/assets/js/50.bfb92a00.js"><link rel="prefetch" href="/assets/js/51.0cbece85.js"><link rel="prefetch" href="/assets/js/52.add1c509.js"><link rel="prefetch" href="/assets/js/53.57ff55f5.js"><link rel="prefetch" href="/assets/js/54.b79fd09c.js"><link rel="prefetch" href="/assets/js/55.ac4d7936.js"><link rel="prefetch" href="/assets/js/56.66b9e3ef.js"><link rel="prefetch" href="/assets/js/57.e70bf088.js"><link rel="prefetch" href="/assets/js/58.ae1694e7.js"><link rel="prefetch" href="/assets/js/59.5a99d3b1.js"><link rel="prefetch" href="/assets/js/6.6f03b31d.js"><link rel="prefetch" href="/assets/js/60.5f4f38b4.js"><link rel="prefetch" href="/assets/js/61.9d742e56.js"><link rel="prefetch" href="/assets/js/62.670b09f0.js"><link rel="prefetch" href="/assets/js/63.f9f8adca.js"><link rel="prefetch" href="/assets/js/64.aa6ede7d.js"><link rel="prefetch" href="/assets/js/65.5202a37e.js"><link rel="prefetch" href="/assets/js/66.ecb7cc6a.js"><link rel="prefetch" href="/assets/js/67.b08a5c76.js"><link rel="prefetch" href="/assets/js/68.502d67dd.js"><link rel="prefetch" href="/assets/js/69.c5041e73.js"><link rel="prefetch" href="/assets/js/7.77e90ab1.js"><link rel="prefetch" href="/assets/js/70.cd2342e1.js"><link rel="prefetch" href="/assets/js/71.9f448730.js"><link rel="prefetch" href="/assets/js/72.098efb15.js"><link rel="prefetch" href="/assets/js/73.da7342aa.js"><link rel="prefetch" href="/assets/js/74.98f3211b.js"><link rel="prefetch" href="/assets/js/75.4e6ffa8f.js"><link rel="prefetch" href="/assets/js/8.8d940901.js"><link rel="prefetch" href="/assets/js/9.dc8d7aad.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b00f5641.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">程序员大彬</span></a> <nav class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <ul class="nav-links can-hide"><li class="nav-item"><a href="/" class="nav-link"><!----> <span>主页</span></a></li><li class="nav-item"><a href="https://docs.qq.com/sheet/DYW9ObnpobXNRTXpq" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>​秋招来啦（内推）</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title">
      Java
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><!----> <span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/java-basic.html" class="nav-link"><!----> <span>基础</span></a></li><li class="dropdown-item"><!----> <a href="/java/java-collection.html" class="nav-link"><!----> <span>集合</span></a></li><li class="dropdown-item"><!----> <a href="/java/java-concurrent.html" class="nav-link"><!----> <span>并发</span></a></li><li class="dropdown-item"><!----> <a href="/java/jvm.html" class="nav-link"><!----> <span>JVM</span></a></li><li class="dropdown-item"><!----> <a href="/java/java8.html" class="nav-link"><!----> <span>Java8新特性</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架中间件" class="dropdown-title"><!----> <span class="title">
      框架中间件
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="框架中间件" class="mobile-dropdown-title"><!----> <span class="title">框架中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/spring.html" class="nav-link"><!----> <span>Spring面试题</span></a></li><li class="dropdown-subitem"><a href="/framework/springmvc.html" class="nav-link"><!----> <span>SpringMVC面试题</span></a></li><li class="dropdown-subitem"><a href="/framework/mybatis.html" class="nav-link"><!----> <span>Mybatis面试题</span></a></li><li class="dropdown-subitem"><a href="/framework/springboot.html" class="nav-link"><!----> <span>SpringBoot面试题</span></a></li><li class="dropdown-subitem"><a href="/framework/springcloud-overview.html" class="nav-link"><!----> <span>SpringCloud详解</span></a></li><li class="dropdown-subitem"><a href="/framework/netty-overview.html" class="nav-link"><!----> <span>Netty详解</span></a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/message-queue/mq.html" class="nav-link"><!----> <span>消息队列面试题</span></a></li><li class="dropdown-subitem"><a href="/message-queue/rabbitmq.html" class="nav-link"><!----> <span>RabbitMQ面试题</span></a></li></ul></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><!----> <span class="title">
      计算机基础
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><!----> <span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computer-basic/network.html" class="nav-link"><!----> <span>网络</span></a></li><li class="dropdown-item"><!----> <a href="/computer-basic/operate-system.html" class="nav-link"><!----> <span>操作系统</span></a></li><li class="dropdown-item"><!----> <a href="/computer-basic/algorithm.html" class="nav-link"><!----> <span>算法</span></a></li><li class="dropdown-item"><!----> <a href="/computer-basic/data-structure.html" class="nav-link"><!----> <span>数据结构</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title">
      数据库
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><!----> <span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          关系型数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/mysql-basic/" class="nav-link"><!----> <span>MySQL基础</span></a></li><li class="dropdown-subitem"><a href="/database/mysql.html" aria-current="page" class="nav-link router-link-exact-active router-link-active"><!----> <span>MySQL面试题</span></a></li><li class="dropdown-subitem"><a href="/database/mysql-execution-plan.html" class="nav-link"><!----> <span>MySQL执行计划详解</span></a></li></ul></li><li class="dropdown-item"><h4>
          非关系型数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/redis/redis-basic.html" class="nav-link"><!----> <span>Redis基础</span></a></li><li class="dropdown-subitem"><a href="/redis/redis.html" class="nav-link"><!----> <span>Redis面试题</span></a></li><li class="dropdown-subitem"><a href="https://mp.weixin.qq.com/s/Ffb8NDgavf9QAWYBm0qAVg" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>ElasticSearch面试题</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><!----> <span class="title">
      分布式
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式" class="mobile-dropdown-title"><!----> <span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/distributed/global-unique-id.html" class="nav-link"><!----> <span>全局唯一ID</span></a></li><li class="dropdown-item"><!----> <a href="/distributed/distributed-lock.html" class="nav-link"><!----> <span>分布式锁</span></a></li><li class="dropdown-item"><!----> <a href="/distributed/rpc.html" class="nav-link"><!----> <span>RPC</span></a></li><li class="dropdown-item"><!----> <a href="/distributed/micro-service.html" class="nav-link"><!----> <span>微服务</span></a></li><li class="dropdown-item"><!----> <a href="/distributed/distributed-transaction.html" class="nav-link"><!----> <span>分布式事务</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程内功" class="dropdown-title"><!----> <span class="title">
      编程内功
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="编程内功" class="mobile-dropdown-title"><!----> <span class="title">编程内功</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advance/design-pattern.html" class="nav-link"><!----> <span>设计模式</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="场景题&amp;系统设计" class="dropdown-title"><!----> <span class="title">
      场景题&amp;系统设计
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="场景题&amp;系统设计" class="mobile-dropdown-title"><!----> <span class="title">场景题&amp;系统设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          海量数据
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mass-data/count-phone-num.html" class="nav-link"><!----> <span>统计不同号码的个数</span></a></li><li class="dropdown-subitem"><a href="/mass-data/find-hign-frequency-word.html" class="nav-link"><!----> <span>出现频率最高的100个词</span></a></li></ul></li><li class="dropdown-item"><h4>
          系统设计
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/system-design/scan-code-login.html" class="nav-link"><!----> <span>扫码登录设计</span></a></li></ul></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><!----> <span class="title">
      工具
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><!----> <span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          开发工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/git-overview.html" class="nav-link"><!----> <span>Git详解</span></a></li><li class="dropdown-subitem"><a href="/tools/maven-overview.html" class="nav-link"><!----> <span>Maven详解</span></a></li><li class="dropdown-subitem"><a href="https://mp.weixin.qq.com/s/ATkZwtw4EF9erGJ4PamTjQ" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>Docker详解</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://mp.weixin.qq.com/s/SKKEeYxif0wWJo6n57rd6A" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>Nginx面试题</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://mp.weixin.qq.com/s/GbTaa3_qs1KvgUD3S2307w" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>Linux常用命令</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          编程利器
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/typora-overview.html" class="nav-link"><!----> <span>markdown编辑器</span></a></li></ul></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习资源" class="dropdown-title"><!----> <span class="title">
      学习资源
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="学习资源" class="mobile-dropdown-title"><!----> <span class="title">学习资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          学习资源
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/Tyson0314/java-books" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>计算机经典电子书PDF</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="/learning-resources/leetcode-note.html" class="nav-link"><!----> <span>Leetcode刷题笔记</span></a></li></ul></li><li class="dropdown-item"><h4>
          学习路线
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learning-resources/java-learn-guide.html" class="nav-link"><!----> <span>Java学习路线</span></a></li><li class="dropdown-subitem"><a href="/learning-resources/cs-learn-guide.html" class="nav-link"><!----> <span>CS学习路线</span></a></li></ul></li></ul></div></li><li class="nav-item"><a href="/other/site-diary.html" class="nav-link"><!----> <span>网站日记</span></a></li> <li class="nav-item"><a href="undefinedundefined/" target="_blank" rel="noopener noreferrer"><!----> <span></span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="theme-switcher"><a class="switch light"><span><i aria-hidden="true" class="fa fa-sun"></i></span></a></div></nav></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <ul class="nav-links"><li class="nav-item"><a href="/" class="nav-link"><!----> <span>主页</span></a></li><li class="nav-item"><a href="https://docs.qq.com/sheet/DYW9ObnpobXNRTXpq" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>​秋招来啦（内推）</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title">
      Java
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><!----> <span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/java-basic.html" class="nav-link"><!----> <span>基础</span></a></li><li class="dropdown-item"><!----> <a href="/java/java-collection.html" class="nav-link"><!----> <span>集合</span></a></li><li class="dropdown-item"><!----> <a href="/java/java-concurrent.html" class="nav-link"><!----> <span>并发</span></a></li><li class="dropdown-item"><!----> <a href="/java/jvm.html" class="nav-link"><!----> <span>JVM</span></a></li><li class="dropdown-item"><!----> <a href="/java/java8.html" class="nav-link"><!----> <span>Java8新特性</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架中间件" class="dropdown-title"><!----> <span class="title">
      框架中间件
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="框架中间件" class="mobile-dropdown-title"><!----> <span class="title">框架中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/spring.html" class="nav-link"><!----> <span>Spring面试题</span></a></li><li class="dropdown-subitem"><a href="/framework/springmvc.html" class="nav-link"><!----> <span>SpringMVC面试题</span></a></li><li class="dropdown-subitem"><a href="/framework/mybatis.html" class="nav-link"><!----> <span>Mybatis面试题</span></a></li><li class="dropdown-subitem"><a href="/framework/springboot.html" class="nav-link"><!----> <span>SpringBoot面试题</span></a></li><li class="dropdown-subitem"><a href="/framework/springcloud-overview.html" class="nav-link"><!----> <span>SpringCloud详解</span></a></li><li class="dropdown-subitem"><a href="/framework/netty-overview.html" class="nav-link"><!----> <span>Netty详解</span></a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/message-queue/mq.html" class="nav-link"><!----> <span>消息队列面试题</span></a></li><li class="dropdown-subitem"><a href="/message-queue/rabbitmq.html" class="nav-link"><!----> <span>RabbitMQ面试题</span></a></li></ul></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><!----> <span class="title">
      计算机基础
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><!----> <span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computer-basic/network.html" class="nav-link"><!----> <span>网络</span></a></li><li class="dropdown-item"><!----> <a href="/computer-basic/operate-system.html" class="nav-link"><!----> <span>操作系统</span></a></li><li class="dropdown-item"><!----> <a href="/computer-basic/algorithm.html" class="nav-link"><!----> <span>算法</span></a></li><li class="dropdown-item"><!----> <a href="/computer-basic/data-structure.html" class="nav-link"><!----> <span>数据结构</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title">
      数据库
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><!----> <span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          关系型数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/mysql-basic/" class="nav-link"><!----> <span>MySQL基础</span></a></li><li class="dropdown-subitem"><a href="/database/mysql.html" aria-current="page" class="nav-link router-link-exact-active router-link-active"><!----> <span>MySQL面试题</span></a></li><li class="dropdown-subitem"><a href="/database/mysql-execution-plan.html" class="nav-link"><!----> <span>MySQL执行计划详解</span></a></li></ul></li><li class="dropdown-item"><h4>
          非关系型数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/redis/redis-basic.html" class="nav-link"><!----> <span>Redis基础</span></a></li><li class="dropdown-subitem"><a href="/redis/redis.html" class="nav-link"><!----> <span>Redis面试题</span></a></li><li class="dropdown-subitem"><a href="https://mp.weixin.qq.com/s/Ffb8NDgavf9QAWYBm0qAVg" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>ElasticSearch面试题</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><!----> <span class="title">
      分布式
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式" class="mobile-dropdown-title"><!----> <span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/distributed/global-unique-id.html" class="nav-link"><!----> <span>全局唯一ID</span></a></li><li class="dropdown-item"><!----> <a href="/distributed/distributed-lock.html" class="nav-link"><!----> <span>分布式锁</span></a></li><li class="dropdown-item"><!----> <a href="/distributed/rpc.html" class="nav-link"><!----> <span>RPC</span></a></li><li class="dropdown-item"><!----> <a href="/distributed/micro-service.html" class="nav-link"><!----> <span>微服务</span></a></li><li class="dropdown-item"><!----> <a href="/distributed/distributed-transaction.html" class="nav-link"><!----> <span>分布式事务</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程内功" class="dropdown-title"><!----> <span class="title">
      编程内功
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="编程内功" class="mobile-dropdown-title"><!----> <span class="title">编程内功</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advance/design-pattern.html" class="nav-link"><!----> <span>设计模式</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="场景题&amp;系统设计" class="dropdown-title"><!----> <span class="title">
      场景题&amp;系统设计
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="场景题&amp;系统设计" class="mobile-dropdown-title"><!----> <span class="title">场景题&amp;系统设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          海量数据
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mass-data/count-phone-num.html" class="nav-link"><!----> <span>统计不同号码的个数</span></a></li><li class="dropdown-subitem"><a href="/mass-data/find-hign-frequency-word.html" class="nav-link"><!----> <span>出现频率最高的100个词</span></a></li></ul></li><li class="dropdown-item"><h4>
          系统设计
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/system-design/scan-code-login.html" class="nav-link"><!----> <span>扫码登录设计</span></a></li></ul></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><!----> <span class="title">
      工具
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><!----> <span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          开发工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/git-overview.html" class="nav-link"><!----> <span>Git详解</span></a></li><li class="dropdown-subitem"><a href="/tools/maven-overview.html" class="nav-link"><!----> <span>Maven详解</span></a></li><li class="dropdown-subitem"><a href="https://mp.weixin.qq.com/s/ATkZwtw4EF9erGJ4PamTjQ" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>Docker详解</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://mp.weixin.qq.com/s/SKKEeYxif0wWJo6n57rd6A" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>Nginx面试题</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://mp.weixin.qq.com/s/GbTaa3_qs1KvgUD3S2307w" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>Linux常用命令</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          编程利器
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/typora-overview.html" class="nav-link"><!----> <span>markdown编辑器</span></a></li></ul></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习资源" class="dropdown-title"><!----> <span class="title">
      学习资源
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="学习资源" class="mobile-dropdown-title"><!----> <span class="title">学习资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          学习资源
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/Tyson0314/java-books" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>计算机经典电子书PDF</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="/learning-resources/leetcode-note.html" class="nav-link"><!----> <span>Leetcode刷题笔记</span></a></li></ul></li><li class="dropdown-item"><h4>
          学习路线
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learning-resources/java-learn-guide.html" class="nav-link"><!----> <span>Java学习路线</span></a></li><li class="dropdown-subitem"><a href="/learning-resources/cs-learn-guide.html" class="nav-link"><!----> <span>CS学习路线</span></a></li></ul></li></ul></div></li><li class="nav-item"><a href="/other/site-diary.html" class="nav-link"><!----> <span>网站日记</span></a></li> <li class="nav-item"><a href="undefinedundefined/" target="_blank" rel="noopener noreferrer"><!----> <span></span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><i></i> <span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/mysql.html#事务的四大特性" class="sidebar-link">事务的四大特性？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#数据库的三大范式" class="sidebar-link">数据库的三大范式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#事务隔离级别有哪些" class="sidebar-link">事务隔离级别有哪些？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#生产环境数据库一般用的什么隔离级别呢" class="sidebar-link">生产环境数据库一般用的什么隔离级别呢？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#编码和字符集的关系" class="sidebar-link">编码和字符集的关系</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#utf8和utf8mb4的区别" class="sidebar-link">utf8和utf8mb4的区别</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#索引" class="sidebar-link">索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/mysql.html#什么是索引" class="sidebar-link">什么是索引？</a></li><li class="sidebar-sub-header"><a href="/database/mysql.html#索引的优缺点" class="sidebar-link">索引的优缺点？</a></li><li class="sidebar-sub-header"><a href="/database/mysql.html#索引的作用" class="sidebar-link">索引的作用？</a></li><li class="sidebar-sub-header"><a href="/database/mysql.html#什么情况下需要建索引" class="sidebar-link">什么情况下需要建索引？</a></li><li class="sidebar-sub-header"><a href="/database/mysql.html#什么情况下不建索引" class="sidebar-link">什么情况下不建索引？</a></li><li class="sidebar-sub-header"><a href="/database/mysql.html#索引的数据结构" class="sidebar-link">索引的数据结构</a></li><li class="sidebar-sub-header"><a href="/database/mysql.html#hash索引和b-树索引的区别" class="sidebar-link">Hash索引和B+树索引的区别？</a></li><li class="sidebar-sub-header"><a href="/database/mysql.html#为什么b-树比b树更适合实现数据库索引" class="sidebar-link">为什么B+树比B树更适合实现数据库索引？</a></li><li class="sidebar-sub-header"><a href="/database/mysql.html#索引有什么分类" class="sidebar-link">索引有什么分类？</a></li><li class="sidebar-sub-header"><a href="/database/mysql.html#什么是最左匹配原则" class="sidebar-link">什么是最左匹配原则？</a></li><li class="sidebar-sub-header"><a href="/database/mysql.html#什么是聚集索引" class="sidebar-link">什么是聚集索引？</a></li><li class="sidebar-sub-header"><a href="/database/mysql.html#什么是覆盖索引" class="sidebar-link">什么是覆盖索引？</a></li><li class="sidebar-sub-header"><a href="/database/mysql.html#索引的设计原则" class="sidebar-link">索引的设计原则？</a></li><li class="sidebar-sub-header"><a href="/database/mysql.html#索引什么时候会失效" class="sidebar-link">索引什么时候会失效？</a></li><li class="sidebar-sub-header"><a href="/database/mysql.html#什么是前缀索引" class="sidebar-link">什么是前缀索引？</a></li><li class="sidebar-sub-header"><a href="/database/mysql.html#索引下推" class="sidebar-link">索引下推</a></li></ul></li><li><a href="/database/mysql.html#常见的存储引擎有哪些" class="sidebar-link">常见的存储引擎有哪些？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#myisam和innodb的区别" class="sidebar-link">MyISAM和InnoDB的区别？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#mvcc-实现原理" class="sidebar-link">MVCC 实现原理？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#快照读和当前读" class="sidebar-link">快照读和当前读</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#共享锁和排他锁" class="sidebar-link">共享锁和排他锁</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#bin-log-redo-log-undo-log" class="sidebar-link">bin log/redo log/undo log</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#bin-log和redo-log有什么区别" class="sidebar-link">bin log和redo log有什么区别？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#讲一下mysql架构" class="sidebar-link">讲一下MySQL架构？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#分库分表" class="sidebar-link">分库分表</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#什么是分区表" class="sidebar-link">什么是分区表？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#分区表类型" class="sidebar-link">分区表类型</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#分区的问题" class="sidebar-link">分区的问题？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#查询语句执行流程" class="sidebar-link">查询语句执行流程？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#更新语句执行过程" class="sidebar-link">更新语句执行过程？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#exist和in的区别" class="sidebar-link">exist和in的区别？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#mysql中int-10-和char-10-的区别" class="sidebar-link">MySQL中int(10)和char(10)的区别？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#truncate、delete与drop区别" class="sidebar-link">truncate、delete与drop区别？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#having和where区别" class="sidebar-link">having和where区别？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#什么是mysql主从同步" class="sidebar-link">什么是MySQL主从同步？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#为什么要做主从同步" class="sidebar-link">为什么要做主从同步？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#乐观锁和悲观锁是什么" class="sidebar-link">乐观锁和悲观锁是什么？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#用过processlist吗" class="sidebar-link">用过processlist吗？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#mysql查询-limit-1000-10-和limit-10-速度一样快吗" class="sidebar-link">MySQL查询 limit 1000,10 和limit 10 速度一样快吗？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#深分页怎么优化" class="sidebar-link">深分页怎么优化？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#高度为3的b-树-可以存放多少数据" class="sidebar-link">高度为3的B+树，可以存放多少数据？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#mysql单表多大进行分库分表" class="sidebar-link">MySQL单表多大进行分库分表？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mysql.html#大表查询慢怎么优化" class="sidebar-link">大表查询慢怎么优化？</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-vpx-content content__default"><p><img src="http://img.dabin-coder.cn/image/MySQL%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93.jpg" alt=""></p> <h2 id="事务的四大特性"><a href="#事务的四大特性" class="header-anchor">#</a> 事务的四大特性？</h2> <p><strong>事务特性ACID</strong>：<strong>原子性</strong>（<code>Atomicity</code>）、<strong>一致性</strong>（<code>Consistency</code>）、<strong>隔离性</strong>（<code>Isolation</code>）、<strong>持久性</strong>（<code>Durability</code>）。</p> <ul><li><strong>原子性</strong>是指事务包含的所有操作要么全部成功，要么全部失败回滚。</li> <li><strong>一致性</strong>是指一个事务执行之前和执行之后都必须处于一致性状态。比如a与b账户共有1000块，两人之间转账之后无论成功还是失败，它们的账户总和还是1000。</li> <li><strong>隔离性</strong>。跟隔离级别相关，如<code>read committed</code>，一个事务只能读到已经提交的修改。</li> <li><strong>持久性</strong>是指一个事务一旦被提交了，那么对数据库中的数据的改变就是永久性的，即便是在数据库系统遇到故障的情况下也不会丢失提交事务的操作。</li></ul> <h2 id="数据库的三大范式"><a href="#数据库的三大范式" class="header-anchor">#</a> 数据库的三大范式</h2> <p><strong>第一范式1NF</strong></p> <p>确保数据库表字段的原子性。</p> <p>比如字段 <code>userInfo</code>: <code>广东省 10086'</code> ，依照第一范式必须拆分成 <code>userInfo</code>: <code>广东省</code> <code>userTel</code>:<code>10086</code>两个字段。</p> <p><strong>第二范式2NF</strong></p> <p>首先要满足第一范式，另外包含两部分内容，一是表必须有一个主键；二是非主键列必须完全依赖于主键，而不能只依赖于主键的一部分。</p> <p>举个例子。假定选课关系表为<code>student_course</code>(student_no, student_name, age, course_name, grade, credit)，主键为(student_no, course_name)。其中学分完全依赖于课程名称，姓名年龄完全依赖学号，不符合第二范式，会导致数据冗余（学生选n门课，姓名年龄有n条记录）、插入异常（插入一门新课，因为没有学号，无法保存新课记录）等问题。</p> <p>应该拆分成三个表：学生：<code>student</code>(stuent_no, student_name, 年龄)；课程：<code>course</code>(course_name, credit)；选课关系：<code>student_course_relation</code>(student_no, course_name, grade)。</p> <p><strong>第三范式3NF</strong></p> <p>首先要满足第二范式，另外非主键列必须直接依赖于主键，不能存在传递依赖。即不能存在：非主键列 A 依赖于非主键列 B，非主键列 B 依赖于主键的情况。</p> <p>假定学生关系表为Student(student_no, student_name, age, academy_id, academy_telephone)，主键为&quot;学号&quot;，其中学院id依赖于学号，而学院地点和学院电话依赖于学院id，存在传递依赖，不符合第三范式。</p> <p>可以把学生关系表分为如下两个表：学生：(student_no, student_name, age, academy_id)；学院：(academy_id, academy_telephone)。</p> <p><strong>2NF和3NF的区别？</strong></p> <ul><li>2NF依据是非主键列是否完全依赖于主键，还是依赖于主键的一部分。</li> <li>3NF依据是非主键列是直接依赖于主键，还是直接依赖于非主键。</li></ul> <h2 id="事务隔离级别有哪些"><a href="#事务隔离级别有哪些" class="header-anchor">#</a> 事务隔离级别有哪些？</h2> <p>先了解下几个概念：脏读、不可重复读、幻读。</p> <ul><li><strong>脏读</strong>是指在一个事务处理过程里读取了另一个未提交的事务中的数据。</li> <li><strong>不可重复读</strong>是指在对于数据库中的某行记录，一个事务范围内多次查询却返回了不同的数据值，这是由于在查询间隔，另一个事务修改了数据并提交了。</li> <li><strong>幻读</strong>是当某个事务在读取某个范围内的记录时，另外一个事务又在该范围内插入了新的记录。对幻读的正确理解是一个事务内的读取操作的结论不能支撑之后业务的执行。假设事务要新增一条记录，主键为id，在新增之前执行了select，没有发现id为xxx的记录，但插入时出现主键冲突，这就属于幻读，读取不到记录却发现主键冲突是因为记录实际上已经被其他的事务插入了，但当前事务不可见。</li></ul> <p><strong>不可重复读和脏读的区别</strong>是，脏读是某一事务读取了另一个事务未提交的脏数据，而不可重复读则是读取了前一事务提交的数据。</p> <p>事务隔离就是为了解决上面提到的脏读、不可重复读、幻读这几个问题。</p> <p>MySQL数据库为我们提供的四种隔离级别：</p> <ul><li><strong>Serializable</strong> (串行化)：通过强制事务排序，使之不可能相互冲突，从而解决幻读问题。</li> <li><strong>Repeatable read</strong> (可重复读)：MySQL的默认事务隔离级别，它确保同一事务的多个实例在并发读取数据时，会看到同样的数据行，解决了不可重复读的问题。</li> <li><strong>Read committed</strong> (读已提交)：一个事务只能看见已经提交事务所做的改变。可避免脏读的发生。</li> <li><strong>Read uncommitted</strong> (读未提交)：所有事务都可以看到其他未提交事务的执行结果。</li></ul> <p>查看隔离级别：</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>select @@transaction_isolation;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>设置隔离级别：</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>set session transaction isolation level read uncommitted;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="生产环境数据库一般用的什么隔离级别呢"><a href="#生产环境数据库一般用的什么隔离级别呢" class="header-anchor">#</a> 生产环境数据库一般用的什么隔离级别呢？</h2> <p><strong>生产环境大多使用RC</strong>。为什么不是RR呢？</p> <blockquote><p>可重复读(Repeatable Read)，简称为RR
读已提交(Read Commited)，简称为RC</p></blockquote> <p>缘由一：在RR隔离级别下，存在间隙锁，导致出现死锁的几率比RC大的多！
缘由二：在RR隔离级别下，条件列未命中索引会锁表！而在RC隔离级别下，只锁行!</p> <p>也就是说，RC的并发性高于RR。</p> <p>并且大部分场景下，不可重复读问题是可以接受的。毕竟数据都已经提交了，读出来本身就没有太大问题！</p> <p><a href="https://zhuanlan.zhihu.com/p/59061106" target="_blank" rel="noopener noreferrer">互联网项目中mysql应该选什么事务隔离级别<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="编码和字符集的关系"><a href="#编码和字符集的关系" class="header-anchor">#</a> 编码和字符集的关系</h2> <p>我们平时可以在编辑器上输入各种中文英文字母，但这些都是给人读的，不是给计算机读的，其实计算机真正保存和传输数据都是以<strong>二进制</strong>0101的格式进行的。</p> <p>那么就需要有一个规则，把中文和英文字母转化为二进制。其中d对应十六进制下的64，它可以转换为01二进制的格式。于是字母和数字就这样一一对应起来了，这就是<strong>ASCII编码</strong>格式。</p> <p>它用<strong>一个字节</strong>，也就是<code>8位</code>来标识字符，基础符号有128个，扩展符号也是128个。也就只能表示下<strong>英文字母和数字</strong>。</p> <p>这明显不够用。于是，为了标识<strong>中文</strong>，出现了<strong>GB2312</strong>的编码格式。为了标识<strong>希腊语</strong>，出现了<strong>greek</strong>编码格式，为了标识<strong>俄语</strong>，整了<strong>cp866</strong>编码格式。</p> <p>为了统一它们，于是出现了<strong>Unicode编码格式</strong>，它用了2~4个字节来表示字符，这样理论上所有符号都能被收录进去，并且它还完全兼容ASCII的编码，也就是说，同样是字母d，在ASCII用64表示，在Unicode里还是用64来表示。</p> <p>但<strong>不同的地方是ASCII编码用1个字节来表示，而Unicode用则两个字节来表示。</strong></p> <p>同样都是字母d，unicode比ascii多使用了一个字节，如下：</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>D   ASCII:           01100100
D Unicode:  00000000 01100100
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>可以看到，上面的unicode编码，前面的都是0，其实用不上，但还占了个字节，有点浪费。如果我们能做到该隐藏时隐藏，这样就能省下不少空间，按这个思路，就是就有了<strong>UTF-8编码</strong>。</p> <p>总结一下，按照一定规则把符号和二进制码对应起来，这就是<strong>编码</strong>。而把n多这种已经编码的字符聚在一起，就是我们常说的<strong>字符集</strong>。</p> <p>比如utf-8字符集就是所有utf-8编码格式的字符的合集。</p> <p>想看下mysql支持哪些字符集。可以执行 <code>show charset;</code></p> <h2 id="utf8和utf8mb4的区别"><a href="#utf8和utf8mb4的区别" class="header-anchor">#</a> utf8和utf8mb4的区别</h2> <p>上面提到utf-8是在unicode的基础上做的优化，既然unicode有办法表示所有字符，那utf-8也一样可以表示所有字符，为了避免混淆，我在后面叫它<strong>大utf8</strong>。</p> <p>mysql支持的字符集中有utf8和utf8mb4。</p> <p>先说<strong>utf8mb4</strong>编码，mb4就是<strong>most bytes 4</strong>的意思，从上图最右边的<code>Maxlen</code>可以看到，它最大支持用<strong>4个字节</strong>来表示字符，它几乎可以用来表示目前已知的所有的字符。</p> <p>再说mysql字符集里的<strong>utf8</strong>，它是数据库的<strong>默认字符集</strong>。但注意，<strong>此utf8非彼utf8</strong>，我们叫它<strong>小utf8</strong>字符集。为什么这么说，因为从Maxlen可以看出，它最多支持用3个字节去表示字符，按utf8mb4的命名方式，准确点应该叫它<strong>utf8mb3</strong>。</p> <p>utf8 就像是阉割版的utf8mb4，只支持部分字符。比如<code>emoji</code>表情，它就不支持。</p> <p>而mysql支持的字符集里，第三列，<strong>collation</strong>，它是指<strong>字符集的比较规则</strong>。</p> <p>比如，**&quot;debug&quot;和&quot;Debug&quot;**是同一个单词，但它们大小写不同，该不该判为同一个单词呢。</p> <p>这时候就需要用到collation了。</p> <p>通过<code>SHOW COLLATION WHERE Charset = 'utf8mb4';</code>可以查看到<code>utf8mb4</code>下支持什么比较规则。</p> <p><img src="http://img.dabin-coder.cn/image/20220527084528.png" alt=""></p> <p>如果<code>collation = utf8mb4_general_ci</code>，是指使用utf8mb4字符集的前提下，<strong>挨个字符进行比较</strong>（<code>general</code>），并且不区分大小写（<code>_ci，case insensitice</code>）。</p> <p>这种情况下，<strong>&quot;debug&quot;和&quot;Debug&quot;是同一个单词</strong>。</p> <p>如果改成<code>collation=utf8mb4_bin</code>，就是指<strong>挨个比较二进制位大小</strong>。</p> <p>于是**&quot;debug&quot;和&quot;Debug&quot;就不是同一个单词**。</p> <p>如果改成<code>collation=utf8mb4_bin</code>，就是指<strong>挨个比较二进制位大小</strong>。</p> <p>于是**&quot;debug&quot;和&quot;Debug&quot;就不是同一个单词**。</p> <p><strong>那utf8mb4对比utf8有什么劣势吗？</strong></p> <p>我们知道数据库表里，字段类型如果是<code>char(2)</code>的话，里面的<code>2</code>是指<strong>字符个数</strong>，也就是说<strong>不管这张表用的是什么编码的字符集</strong>，都能放上2个字符。</p> <p>而char又是<strong>固定长度</strong>，为了能放下2个utf8mb4的字符，char会默认保留<code>2*4（maxlen=4）= 8</code>个字节的空间。</p> <p>如果是utf8mb3，则会默认保留 <code>2 * 3 (maxlen=3) = 6</code>个字节的空间。也就是说，在这种情况下，<strong>utf8mb4会比utf8mb3多使用一些空间。</strong></p> <h2 id="索引"><a href="#索引" class="header-anchor">#</a> 索引</h2> <h3 id="什么是索引"><a href="#什么是索引" class="header-anchor">#</a> 什么是索引？</h3> <p>索引是存储引擎用于提高数据库表的访问速度的一种<strong>数据结构</strong>。</p> <h3 id="索引的优缺点"><a href="#索引的优缺点" class="header-anchor">#</a> 索引的优缺点？</h3> <p>优点：</p> <ul><li><strong>加快数据查找的速度</strong></li> <li>为用来排序或者是分组的字段添加索引，可以加快分组和排序的速度</li> <li>加快表与表之间的连接</li></ul> <p>缺点：</p> <ul><li>建立索引需要<strong>占用物理空间</strong></li> <li>会降低表的增删改的效率，因为每次对表记录进行增删改，需要进行<strong>动态维护索引</strong>，导致增删改时间变长</li></ul> <h3 id="索引的作用"><a href="#索引的作用" class="header-anchor">#</a> 索引的作用？</h3> <p>数据是存储在磁盘上的，查询数据时，如果没有索引，会加载所有的数据到内存，依次进行检索，读取磁盘次数较多。有了索引，就不需要加载所有数据，因为B+树的高度一般在2-4层，最多只需要读取2-4次磁盘，查询速度大大提升。</p> <h3 id="什么情况下需要建索引"><a href="#什么情况下需要建索引" class="header-anchor">#</a> 什么情况下需要建索引？</h3> <ol><li>经常用于查询的字段</li> <li>经常用于连接的字段建立索引，可以加快连接的速度</li> <li>经常需要排序的字段建立索引，因为索引已经排好序，可以加快排序查询速度</li></ol> <h3 id="什么情况下不建索引"><a href="#什么情况下不建索引" class="header-anchor">#</a> 什么情况下不建索引？</h3> <ol><li><code>where</code>条件中用不到的字段不适合建立索引</li> <li>表记录较少。比如只有几百条数据，没必要加索引。</li> <li>需要经常增删改。需要评估是否适合加索引</li> <li><strong>参与列计算</strong>的列不适合建索引</li> <li><strong>区分度不高</strong>的字段不适合建立索引，如性别，只有男/女/未知三个值。加了索引，查询效率也不会提高。</li></ol> <h3 id="索引的数据结构"><a href="#索引的数据结构" class="header-anchor">#</a> 索引的数据结构</h3> <p>索引的数据结构主要有B+树和哈希表，对应的索引分别为B+树索引和哈希索引。InnoDB引擎的索引类型有B+树索引和哈希索引，默认的索引类型为B+树索引。</p> <p><strong>B+树索引</strong></p> <p>B+ 树是基于B 树和叶子节点顺序访问指针进行实现，它具有B树的平衡性，并且通过顺序访问指针来提高区间查询的性能。</p> <p>在 B+ 树中，节点中的 <code>key</code> 从左到右递增排列，如果某个指针的左右相邻 <code>key</code> 分别是 key<sub>i</sub> 和 key<sub>i+1</sub>，则该指针指向节点的所有 <code>key</code> 大于等于 key<sub>i</sub> 且小于等于 key<sub>i+1</sub>。</p> <p><img src="http://img.dabin-coder.cn/image/B+%E6%A0%91%E7%B4%A2%E5%BC%950.png" alt=""></p> <p>进行查找操作时，首先在根节点进行二分查找，找到<code>key</code>所在的指针，然后递归地在指针所指向的节点进行查找。直到查找到叶子节点，然后在叶子节点上进行二分查找，找出<code>key</code>所对应的数据项。</p> <p>MySQL 数据库使用最多的索引类型是<code>BTREE</code>索引，底层基于B+树数据结构来实现。</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>mysql&gt; show index from blog\G;
*************************** 1. row ***************************
        Table: blog
   Non_unique: 0
     Key_name: PRIMARY
 Seq_in_index: 1
  Column_name: blog_id
    Collation: A
  Cardinality: 4
     Sub_part: NULL
       Packed: NULL
         Null:
   Index_type: BTREE
      Comment:
Index_comment:
      Visible: YES
   Expression: NULL
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>哈希索引</strong></p> <p>哈希索引是基于哈希表实现的，对于每一行数据，存储引擎会对索引列进行哈希计算得到哈希码，并且哈希算法要尽量保证不同的列值计算出的哈希码值是不同的，将哈希码的值作为哈希表的key值，将指向数据行的指针作为哈希表的value值。这样查找一个数据的时间复杂度就是O(1)，一般多用于精确查找。</p> <h3 id="hash索引和b-树索引的区别"><a href="#hash索引和b-树索引的区别" class="header-anchor">#</a> Hash索引和B+树索引的区别？</h3> <ul><li>哈希索引<strong>不支持排序</strong>，因为哈希表是无序的。</li> <li>哈希索引<strong>不支持范围查找</strong>。</li> <li>哈希索引<strong>不支持模糊查询</strong>及多列索引的最左前缀匹配。</li> <li>因为哈希表中会<strong>存在哈希冲突</strong>，所以哈希索引的性能是不稳定的，而B+树索引的性能是相对稳定的，每次查询都是从根节点到叶子节点。</li></ul> <h3 id="为什么b-树比b树更适合实现数据库索引"><a href="#为什么b-树比b树更适合实现数据库索引" class="header-anchor">#</a> 为什么B+树比B树更适合实现数据库索引？</h3> <ul><li><p>由于B+树的数据都存储在叶子结点中，叶子结点均为索引，方便扫库，只需要扫一遍叶子结点即可，但是B树因为其分支结点同样存储着数据，我们要找到具体的数据，需要进行一次中序遍历按序来扫，所以B+树更加适合在区间查询的情况，而在数据库中基于范围的查询是非常频繁的，所以通常B+树用于数据库索引。</p></li> <li><p>B+树的节点只存储索引key值，具体信息的地址存在于叶子节点的地址中。这就使以页为单位的索引中可以存放更多的节点。减少更多的I/O支出。</p></li> <li><p>B+树的查询效率更加稳定，任何关键字的查找必须走一条从根结点到叶子结点的路。所有关键字查询的路径长度相同，导致每一个数据的查询效率相当。</p></li></ul> <h3 id="索引有什么分类"><a href="#索引有什么分类" class="header-anchor">#</a> 索引有什么分类？</h3> <p>1、<strong>主键索引</strong>：名为primary的唯一非空索引，不允许有空值。</p> <p>2、<strong>唯一索引</strong>：索引列中的值必须是唯一的，但是允许为空值。唯一索引和主键索引的区别是：唯一索引字段可以为null且可以存在多个null值，而主键索引字段不可以为null。唯一索引的用途：唯一标识数据库表中的每条记录，主要是用来防止数据重复插入。创建唯一索引的SQL语句如下：</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>ALTER TABLE table_name
ADD CONSTRAINT constraint_name UNIQUE KEY(column_1,column_2,...);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>3、<strong>组合索引</strong>：在表中的多个字段组合上创建的索引，只有在查询条件中使用了这些字段的左边字段时，索引才会被使用，使用组合索引时需遵循最左前缀原则。</p> <p>4、<strong>全文索引</strong>：只能在<code>CHAR</code>、<code>VARCHAR</code>和<code>TEXT</code>类型字段上使用全文索引。</p> <p>5、<strong>普通索引</strong>：普通索引是最基本的索引，它没有任何限制，值可以为空。</p> <h3 id="什么是最左匹配原则"><a href="#什么是最左匹配原则" class="header-anchor">#</a> 什么是最左匹配原则？</h3> <p>如果 SQL 语句中用到了组合索引中的最左边的索引，那么这条 SQL 语句就可以利用这个组合索引去进行匹配。当遇到范围查询(<code>&gt;</code>、<code>&lt;</code>、<code>between</code>、<code>like</code>)就会停止匹配，后面的字段不会用到索引。</p> <p>对<code>(a,b,c)</code>建立索引，查询条件使用 a/ab/abc 会走索引，使用 bc 不会走索引。</p> <p>对<code>(a,b,c,d)</code>建立索引，查询条件为<code>a = 1 and b = 2 and c &gt; 3 and d = 4</code>，那么a、b和c三个字段能用到索引，而d无法使用索引。因为遇到了范围查询。</p> <p>如下图，对(a, b) 建立索引，a 在索引树中是全局有序的，而 b 是全局无序，局部有序（当a相等时，会根据b进行排序）。直接执行<code>b = 2</code>这种查询条件无法使用索引。</p> <p><img src="http://img.dabin-coder.cn/image/%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80.png" alt="最左前缀"></p> <p>当a的值确定的时候，b是有序的。例如<code>a = 1</code>时，b值为1，2是有序的状态。当<code>a = 2</code>时候，b的值为1，4也是有序状态。 当执行<code>a = 1 and b = 2</code>时a和b字段能用到索引。而执行<code>a &gt; 1 and b = 2</code>时，a字段能用到索引，b字段用不到索引。因为a的值此时是一个范围，不是固定的，在这个范围内b值不是有序的，因此b字段无法使用索引。</p> <h3 id="什么是聚集索引"><a href="#什么是聚集索引" class="header-anchor">#</a> 什么是聚集索引？</h3> <p>InnoDB使用表的主键构造主键索引树，同时叶子节点中存放的即为整张表的记录数据。聚集索引叶子节点的存储是逻辑上连续的，使用双向链表连接，叶子节点按照主键的顺序排序，因此对于主键的排序查找和范围查找速度比较快。</p> <p>聚集索引的叶子节点就是整张表的行记录。InnoDB 主键使用的是聚簇索引。聚集索引要比非聚集索引查询效率高很多。</p> <p>对于<code>InnoDB</code>来说，聚集索引一般是表中的主键索引，如果表中没有显示指定主键，则会选择表中的第一个不允许为<code>NULL</code>的唯一索引。如果没有主键也没有合适的唯一索引，那么<code>InnoDB</code>内部会生成一个隐藏的主键作为聚集索引，这个隐藏的主键长度为6个字节，它的值会随着数据的插入自增。</p> <h3 id="什么是覆盖索引"><a href="#什么是覆盖索引" class="header-anchor">#</a> 什么是覆盖索引？</h3> <p><code>select</code>的数据列只用从索引中就能够取得，不需要<strong>回表</strong>进行二次查询，也就是说查询列要被所使用的索引覆盖。对于<code>innodb</code>表的二级索引，如果索引能覆盖到查询的列，那么就可以避免对主键索引的二次查询。</p> <p>不是所有类型的索引都可以成为覆盖索引。覆盖索引要存储索引列的值，而哈希索引、全文索引不存储索引列的值，所以MySQL使用b+树索引做覆盖索引。</p> <p>对于使用了覆盖索引的查询，在查询前面使用<code>explain</code>，输出的extra列会显示为<code>using index</code>。</p> <p>比如<code>user_like</code> 用户点赞表，组合索引为<code>(user_id, blog_id)</code>，<code>user_id</code>和<code>blog_id</code>都不为<code>null</code>。</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>explain select blog_id from user_like where user_id = 13;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>explain</code>结果的<code>Extra</code>列为<code>Using index</code>，查询的列被索引覆盖，并且where筛选条件符合最左前缀原则，通过<strong>索引查找</strong>就能直接找到符合条件的数据，不需要回表查询数据。</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>explain select user_id from user_like where blog_id = 1;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>explain</code>结果的<code>Extra</code>列为<code>Using where; Using index</code>， 查询的列被索引覆盖，where筛选条件不符合最左前缀原则，无法通过索引查找找到符合条件的数据，但可以通过<strong>索引扫描</strong>找到符合条件的数据，也不需要回表查询数据。</p> <p><img src="http://img.dabin-coder.cn/image/cover-index.png" alt=""></p> <h3 id="索引的设计原则"><a href="#索引的设计原则" class="header-anchor">#</a> 索引的设计原则？</h3> <ul><li>索引列的<strong>区分度越高</strong>，索引的效果越好。比如使用性别这种区分度很低的列作为索引，效果就会很差。</li> <li>尽量使用<strong>短索引</strong>，对于较长的字符串进行索引时应该指定一个较短的前缀长度，因为较小的索引涉及到的磁盘I/O较少，查询速度更快。</li> <li>索引不是越多越好，每个索引都需要额外的物理空间，维护也需要花费时间。</li> <li>利用<strong>最左前缀原则</strong>。</li></ul> <h3 id="索引什么时候会失效"><a href="#索引什么时候会失效" class="header-anchor">#</a> 索引什么时候会失效？</h3> <p>导致索引失效的情况：</p> <ul><li>对于组合索引，不是使用组合索引最左边的字段，则不会使用索引</li> <li>以%开头的like查询如<code>%abc</code>，无法使用索引；非%开头的like查询如<code>abc%</code>，相当于范围查询，会使用索引</li> <li>查询条件中列类型是字符串，没有使用引号，可能会因为类型不同发生隐式转换，使索引失效</li> <li>判断索引列是否不等于某个值时</li> <li>对索引列进行运算</li> <li>查询条件使用<code>or</code>连接，也会导致索引失效</li></ul> <h3 id="什么是前缀索引"><a href="#什么是前缀索引" class="header-anchor">#</a> 什么是前缀索引？</h3> <p>有时需要在很长的字符列上创建索引，这会造成索引特别大且慢。使用前缀索引可以避免这个问题。</p> <p>前缀索引是指对文本或者字符串的前几个字符建立索引，这样索引的长度更短，查询速度更快。</p> <p>创建前缀索引的关键在于选择足够长的前缀以<strong>保证较高的索引选择性</strong>。索引选择性越高查询效率就越高，因为选择性高的索引可以让MySQL在查找时过滤掉更多的数据行。</p> <p>建立前缀索引的方式：</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>// email列创建前缀索引
ALTER TABLE table_name ADD KEY(column_name(prefix_length));
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="索引下推"><a href="#索引下推" class="header-anchor">#</a> 索引下推</h3> <p>参考我的另一篇文章：<a href="http://mp.weixin.qq.com/s?__biz=Mzg2OTY1NzY0MQ==&amp;mid=2247486661&amp;idx=1&amp;sn=4771369fd5c624c96647696ae76eca4a&amp;chksm=ce98f183f9ef789562ac15c02b0d0dfdf3d2f178ea26667f5aded5d24c1004f049b951e85b33&amp;scene=126&amp;&amp;sessionid=1650167859#rd" target="_blank" rel="noopener noreferrer">图解索引下推！<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="常见的存储引擎有哪些"><a href="#常见的存储引擎有哪些" class="header-anchor">#</a> 常见的存储引擎有哪些？</h2> <p>MySQL中常用的四种存储引擎分别是： <strong>MyISAM</strong>、<strong>InnoDB</strong>、<strong>MEMORY</strong>、<strong>ARCHIVE</strong>。MySQL 5.5版本后默认的存储引擎为<code>InnoDB</code>。</p> <p><strong>InnoDB存储引擎</strong></p> <p>InnoDB是MySQL<strong>默认的事务型存储引擎</strong>，使用最广泛，基于聚簇索引建立的。InnoDB内部做了很多优化，如能够自动在内存中创建自适应hash索引，以加速读操作。</p> <p><strong>优点</strong>：支持事务和崩溃修复能力；引入了行级锁和外键约束。</p> <p><strong>缺点</strong>：占用的数据空间相对较大。</p> <p><strong>适用场景</strong>：需要事务支持，并且有较高的并发读写频率。</p> <p><strong>MyISAM存储引擎</strong></p> <p>数据以紧密格式存储。对于只读数据，或者表比较小、可以容忍修复操作，可以使用MyISAM引擎。MyISAM会将表存储在两个文件中，数据文件<code>.MYD</code>和索引文件<code>.MYI</code>。</p> <p><strong>优点</strong>：访问速度快。</p> <p><strong>缺点</strong>：MyISAM不支持事务和行级锁，不支持崩溃后的安全恢复，也不支持外键。</p> <p><strong>适用场景</strong>：对事务完整性没有要求；表的数据都会只读的。</p> <p><strong>MEMORY存储引擎</strong></p> <p>MEMORY引擎将数据全部放在内存中，访问速度较快，但是一旦系统奔溃的话，数据都会丢失。</p> <p>MEMORY引擎默认使用哈希索引，将键的哈希值和指向数据行的指针保存在哈希索引中。</p> <p><strong>优点</strong>：访问速度较快。</p> <p><strong>缺点</strong>：</p> <ol><li>哈希索引数据不是按照索引值顺序存储，无法用于排序。</li> <li>不支持部分索引匹配查找，因为哈希索引是使用索引列的全部内容来计算哈希值的。</li> <li>只支持等值比较，不支持范围查询。</li> <li>当出现哈希冲突时，存储引擎需要遍历链表中所有的行指针，逐行进行比较，直到找到符合条件的行。</li></ol> <p><strong>ARCHIVE存储引擎</strong></p> <p>ARCHIVE存储引擎非常适合存储大量独立的、作为历史记录的数据。ARCHIVE提供了压缩功能，拥有高效的插入速度，但是这种引擎不支持索引，所以查询性能较差。</p> <h2 id="myisam和innodb的区别"><a href="#myisam和innodb的区别" class="header-anchor">#</a> MyISAM和InnoDB的区别？</h2> <ol><li><p><strong>是否支持行级锁</strong> : <code>MyISAM</code> 只有表级锁，而<code>InnoDB</code> 支持行级锁和表级锁，默认为行级锁。</p></li> <li><p><strong>是否支持事务和崩溃后的安全恢复</strong>： <code>MyISAM</code> 不提供事务支持。而<code>InnoDB</code>提供事务支持，具有事务、回滚和崩溃修复能力。</p></li> <li><p><strong>是否支持外键：</strong> <code>MyISAM</code>不支持，而<code>InnoDB</code>支持。</p></li> <li><p><strong>是否支持MVCC</strong> ：<code>MyISAM</code>不支持，<code>InnoDB</code>支持。应对高并发事务，MVCC比单纯的加锁更高效。</p></li> <li><p><code>MyISAM</code>不支持聚集索引，<code>InnoDB</code>支持聚集索引。</p></li></ol> <h2 id="mvcc-实现原理"><a href="#mvcc-实现原理" class="header-anchor">#</a> MVCC 实现原理？</h2> <p>MVCC(<code>Multiversion concurrency control</code>) 就是同一份数据保留多版本的一种方式，进而实现并发控制。在查询的时候，通过<code>read view</code>和版本链找到对应版本的数据。</p> <p>作用：提升并发性能。对于高并发场景，MVCC比行级锁开销更小。</p> <p><strong>MVCC 实现原理如下：</strong></p> <p>MVCC 的实现依赖于版本链，版本链是通过表的三个隐藏字段实现。</p> <ul><li><code>DB_TRX_ID</code>：当前事务id，通过事务id的大小判断事务的时间顺序。</li> <li><code>DB_ROLL_PTR</code>：回滚指针，指向当前行记录的上一个版本，通过这个指针将数据的多个版本连接在一起构成<code>undo log</code>版本链。</li> <li><code>DB_ROW_ID</code>：主键，如果数据表没有主键，InnoDB会自动生成主键。</li></ul> <p>每条表记录大概是这样的：</p> <p><img src="http://img.dabin-coder.cn/image/mvcc9.png" alt=""></p> <p>使用事务更新行记录的时候，就会生成版本链，执行过程如下：</p> <ol><li>用排他锁锁住该行；</li> <li>将该行原本的值拷贝到<code>undo log</code>，作为旧版本用于回滚；</li> <li>修改当前行的值，生成一个新版本，更新事务id，使回滚指针指向旧版本的记录，这样就形成一条版本链。</li></ol> <p>下面举个例子方便大家理解。</p> <p>1、初始数据如下，其中<code>DB_ROW_ID</code>和<code>DB_ROLL_PTR</code>为空。</p> <p><img src="http://img.dabin-coder.cn/image/mvcc2.png" alt=""></p> <p>2、事务A对该行数据做了修改，将<code>age</code>修改为12，效果如下：</p> <p><img src="http://img.dabin-coder.cn/image/mvcc7.png" alt=""></p> <p>3、之后事务B也对该行记录做了修改，将<code>age</code>修改为8，效果如下：</p> <p><img src="http://img.dabin-coder.cn/image/mvcc11.png" alt=""></p> <p>4、此时undo log有两行记录，并且通过回滚指针连在一起。</p> <p><strong>接下来了解下read view的概念。</strong></p> <p><code>read view</code>可以理解成将数据在每个时刻的状态拍成“照片”记录下来。在获取某时刻t的数据时，到t时间点拍的“照片”上取数据。</p> <p>在<code>read view</code>内部维护一个活跃事务链表，表示生成<code>read view</code>的时候还在活跃的事务。这个链表包含在创建<code>read view</code>之前还未提交的事务，不包含创建<code>read view</code>之后提交的事务。</p> <p>不同隔离级别创建read view的时机不同。</p> <ul><li><p>read committed：每次执行select都会创建新的read_view，保证能读取到其他事务已经提交的修改。</p></li> <li><p>repeatable read：在一个事务范围内，第一次select时更新这个read_view，以后不会再更新，后续所有的select都是复用之前的read_view。这样可以保证事务范围内每次读取的内容都一样，即可重复读。</p></li></ul> <p><strong>read view的记录筛选方式</strong></p> <p><strong>前提</strong>：<code>DATA_TRX_ID</code> 表示每个数据行的最新的事务ID；<code>up_limit_id</code>表示当前快照中的最先开始的事务；<code>low_limit_id</code>表示当前快照中的最慢开始的事务，即最后一个事务。</p> <p><img src="http://img.dabin-coder.cn/image/read_view10.png" alt=""></p> <ul><li>如果<code>DATA_TRX_ID</code> &lt; <code>up_limit_id</code>：说明在创建<code>read view</code>时，修改该数据行的事务已提交，该版本的记录可被当前事务读取到。</li> <li>如果<code>DATA_TRX_ID</code> &gt;= <code>low_limit_id</code>：说明当前版本的记录的事务是在创建<code>read view</code>之后生成的，该版本的数据行不可以被当前事务访问。此时需要通过版本链找到上一个版本，然后重新判断该版本的记录对当前事务的可见性。</li> <li>如果<code>up_limit_id</code> &lt;= <code>DATA_TRX_ID</code> &lt; <code>low_limit_i</code>：
<ol><li>需要在活跃事务链表中查找是否存在ID为<code>DATA_TRX_ID</code>的值的事务。</li> <li>如果存在，因为在活跃事务链表中的事务是未提交的，所以该记录是不可见的。此时需要通过版本链找到上一个版本，然后重新判断该版本的可见性。</li> <li>如果不存在，说明事务trx_id 已经提交了，这行记录是可见的。</li></ol></li></ul> <p><strong>总结</strong>：InnoDB 的<code>MVCC</code>是通过 <code>read view</code> 和版本链实现的，版本链保存有历史版本记录，通过<code>read view</code> 判断当前版本的数据是否可见，如果不可见，再从版本链中找到上一个版本，继续进行判断，直到找到一个可见的版本。</p> <h2 id="快照读和当前读"><a href="#快照读和当前读" class="header-anchor">#</a> 快照读和当前读</h2> <p>表记录有两种读取方式。</p> <ul><li><p>快照读：读取的是快照版本。普通的<code>SELECT</code>就是快照读。通过mvcc来进行并发控制的，不用加锁。</p></li> <li><p>当前读：读取的是最新版本。<code>UPDATE、DELETE、INSERT、SELECT … LOCK IN SHARE MODE、SELECT … FOR UPDATE</code>是当前读。</p></li></ul> <p>快照读情况下，InnoDB通过<code>mvcc</code>机制避免了幻读现象。而<code>mvcc</code>机制无法避免当前读情况下出现的幻读现象。因为当前读每次读取的都是最新数据，这时如果两次查询中间有其它事务插入数据，就会产生幻读。</p> <p>下面举个例子说明下：</p> <p>1、首先，user表只有两条记录，具体如下：</p> <p><img src="http://img.dabin-coder.cn/image/image-20210922232259664.png" alt=""></p> <p>2、事务a和事务b同时开启事务<code>start transaction</code>；</p> <p>3、事务a插入数据然后提交；</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>insert into user(user_name, user_password, user_mail, user_state) values('tyson', 'a', 'a', 0);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>4、事务b执行全表的update；</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>update user set user_name = 'a';
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>5、事务b然后执行查询，查到了事务a中插入的数据。（下图左边是事务b，右边是事务a。事务开始之前只有两条记录，事务a插入一条数据之后，事务b查询出来是三条数据）</p> <p><img src="http://img.dabin-coder.cn/image/%E5%B9%BB%E8%AF%BB1.png" alt=""></p> <p>以上就是当前读出现的幻读现象。</p> <p><strong>那么MySQL是如何避免幻读？</strong></p> <ul><li>在快照读情况下，MySQL通过<code>mvcc</code>来避免幻读。</li> <li>在当前读情况下，MySQL通过<code>next-key</code>来避免幻读（加行锁和间隙锁来实现的）。</li></ul> <p>next-key包括两部分：行锁和间隙锁。行锁是加在索引上的锁，间隙锁是加在索引之间的。</p> <p><code>Serializable</code>隔离级别也可以避免幻读，会锁住整张表，并发性极低，一般不会使用。</p> <h2 id="共享锁和排他锁"><a href="#共享锁和排他锁" class="header-anchor">#</a> 共享锁和排他锁</h2> <p>SELECT 的读取锁定主要分为两种方式：共享锁和排他锁。</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>select * from table where id&lt;6 lock in share mode;--共享锁
select * from table where id&lt;6 for update;--排他锁
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这两种方式主要的不同在于<code>LOCK IN SHARE MODE</code>多个事务同时更新同一个表单时很容易造成死锁。</p> <p>申请排他锁的前提是，没有线程对该结果集的任何行数据使用排它锁或者共享锁，否则申请会受到阻塞。在进行事务操作时，MySQL会对查询结果集的每行数据添加排它锁，其他线程对这些数据的更改或删除操作会被阻塞（只能读操作），直到该语句的事务被<code>commit</code>语句或<code>rollback</code>语句结束为止。</p> <p><code>SELECT... FOR UPDATE</code> 使用注意事项：</p> <ol><li><code>for update</code> 仅适用于innodb，且必须在事务范围内才能生效。</li> <li>根据主键进行查询，查询条件为<code>like</code>或者不等于，主键字段产生<strong>表锁</strong>。</li> <li>根据非索引字段进行查询，会产生<strong>表锁</strong>。</li></ol> <h2 id="bin-log-redo-log-undo-log"><a href="#bin-log-redo-log-undo-log" class="header-anchor">#</a> bin log/redo log/undo log</h2> <p>MySQL日志主要包括查询日志、慢查询日志、事务日志、错误日志、二进制日志等。其中比较重要的是 <code>bin log</code>（二进制日志）和 <code>redo log</code>（重做日志）和 <code>undo log</code>（回滚日志）。</p> <p><strong>bin log</strong></p> <p><code>bin log</code>是MySQL数据库级别的文件，记录对MySQL数据库执行修改的所有操作，不会记录select和show语句，主要用于恢复数据库和同步数据库。</p> <p><strong>redo log</strong></p> <p><code>redo log</code>是innodb引擎级别，用来记录innodb存储引擎的事务日志，不管事务是否提交都会记录下来，用于数据恢复。当数据库发生故障，innoDB存储引擎会使用<code>redo log</code>恢复到发生故障前的时刻，以此来保证数据的完整性。将参数<code>innodb_flush_log_at_tx_commit</code>设置为1，那么在执行commit时会将<code>redo log</code>同步写到磁盘。</p> <p><strong>undo log</strong></p> <p>除了记录<code>redo log</code>外，当进行数据修改时还会记录<code>undo log</code>，<code>undo log</code>用于数据的撤回操作，它保留了记录修改前的内容。通过<code>undo log</code>可以实现事务回滚，并且可以根据<code>undo log</code>回溯到某个特定的版本的数据，<strong>实现MVCC</strong>。</p> <h2 id="bin-log和redo-log有什么区别"><a href="#bin-log和redo-log有什么区别" class="header-anchor">#</a> bin log和redo log有什么区别？</h2> <ol><li><code>bin log</code>会记录所有日志记录，包括InnoDB、MyISAM等存储引擎的日志；<code>redo log</code>只记录innoDB自身的事务日志。</li> <li><code>bin log</code>只在事务提交前写入到磁盘，一个事务只写一次；而在事务进行过程，会有<code>redo log</code>不断写入磁盘。</li> <li><code>bin log</code>是逻辑日志，记录的是SQL语句的原始逻辑；<code>redo log</code>是物理日志，记录的是在某个数据页上做了什么修改。</li></ol> <h2 id="讲一下mysql架构"><a href="#讲一下mysql架构" class="header-anchor">#</a> 讲一下MySQL架构？</h2> <p>MySQL主要分为 Server 层和存储引擎层：</p> <ul><li><strong>Server 层</strong>：主要包括连接器、查询缓存、分析器、优化器、执行器等，所有跨存储引擎的功能都在这一层实现，比如存储过程、触发器、视图，函数等，还有一个通用的日志模块 binglog 日志模块。</li> <li><strong>存储引擎</strong>： 主要负责数据的存储和读取。server 层通过api与存储引擎进行通信。</li></ul> <p><strong>Server 层基本组件</strong></p> <ul><li><strong>连接器：</strong> 当客户端连接 MySQL 时，server层会对其进行身份认证和权限校验。</li> <li><strong>查询缓存:</strong> 执行查询语句的时候，会先查询缓存，先校验这个 sql 是否执行过，如果有缓存这个 sql，就会直接返回给客户端，如果没有命中，就会执行后续的操作。</li> <li><strong>分析器:</strong> 没有命中缓存的话，SQL 语句就会经过分析器，主要分为两步，词法分析和语法分析，先看 SQL 语句要做什么，再检查 SQL 语句语法是否正确。</li> <li><strong>优化器：</strong> 优化器对查询进行优化，包括重写查询、决定表的读写顺序以及选择合适的索引等，生成执行计划。</li> <li><strong>执行器：</strong> 首先执行前会校验该用户有没有权限，如果没有权限，就会返回错误信息，如果有权限，就会根据执行计划去调用引擎的接口，返回结果。</li></ul> <h2 id="分库分表"><a href="#分库分表" class="header-anchor">#</a> 分库分表</h2> <p>当单表的数据量达到1000W或100G以后，优化索引、添加从库等可能对数据库性能提升效果不明显，此时就要考虑对其进行切分了。切分的目的就在于减少数据库的负担，缩短查询的时间。</p> <p>数据切分可以分为两种方式：垂直划分和水平划分。</p> <p><strong>垂直划分</strong></p> <p>垂直划分数据库是根据业务进行划分，例如购物场景，可以将库中涉及商品、订单、用户的表分别划分出成一个库，通过降低单库的大小来提高性能。同样的，分表的情况就是将一个大表根据业务功能拆分成一个个子表，例如商品基本信息和商品描述，商品基本信息一般会展示在商品列表，商品描述在商品详情页，可以将商品基本信息和商品描述拆分成两张表。</p> <p><img src="http://img.dabin-coder.cn/image/%E5%9E%82%E7%9B%B4%E5%88%92%E5%88%86.png" alt=""></p> <p><strong>优点</strong>：行记录变小，数据页可以存放更多记录，在查询时减少I/O次数。</p> <p><strong>缺点</strong>：</p> <ul><li>主键出现冗余，需要管理冗余列；</li> <li>会引起表连接JOIN操作，可以通过在业务服务器上进行join来减少数据库压力；</li> <li>依然存在单表数据量过大的问题。</li></ul> <p><strong>水平划分</strong></p> <p>水平划分是根据一定规则，例如时间或id序列值等进行数据的拆分。比如根据年份来拆分不同的数据库。每个数据库结构一致，但是数据得以拆分，从而提升性能。</p> <p><img src="http://img.dabin-coder.cn/image/%E6%B0%B4%E5%B9%B3%E5%88%92%E5%88%86.png" alt=""></p> <p><strong>优点</strong>：单库（表）的数据量得以减少，提高性能；切分出的表结构相同，程序改动较少。</p> <p><strong>缺点</strong>：</p> <ul><li>分片事务一致性难以解决</li> <li>跨节点<code>join</code>性能差，逻辑复杂</li> <li>数据分片在扩容时需要迁移</li></ul> <h2 id="什么是分区表"><a href="#什么是分区表" class="header-anchor">#</a> 什么是分区表？</h2> <p>分区是把一张表的数据分成N多个区块。分区表是一个独立的逻辑表，但是底层由多个物理子表组成。</p> <p>当查询条件的数据分布在某一个分区的时候，查询引擎只会去某一个分区查询，而不是遍历整个表。在管理层面，如果需要删除某一个分区的数据，只需要删除对应的分区即可。</p> <p>分区一般都是放在单机里的，用的比较多的是时间范围分区，方便归档。只不过分库分表需要代码实现，分区则是mysql内部实现。分库分表和分区并不冲突，可以结合使用。</p> <h2 id="分区表类型"><a href="#分区表类型" class="header-anchor">#</a> 分区表类型</h2> <p><strong>range分区</strong>，按照范围分区。比如按照时间范围分区</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>CREATE <span class="token class-name">TABLE</span> <span class="token function">test_range_partition</span><span class="token punctuation">(</span>
       id <span class="token class-name">INT</span> auto_increment<span class="token punctuation">,</span>
       createdate DATETIME<span class="token punctuation">,</span>
       primary key <span class="token punctuation">(</span>id<span class="token punctuation">,</span>createdate<span class="token punctuation">)</span>
   <span class="token punctuation">)</span> 
   PARTITION <span class="token class-name">BY</span> RANGE <span class="token punctuation">(</span><span class="token function">TO_DAYS</span><span class="token punctuation">(</span>createdate<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">(</span>
      PARTITION p201801 VALUES <span class="token class-name">LESS</span> THAN <span class="token punctuation">(</span> <span class="token function">TO_DAYS</span><span class="token punctuation">(</span>'<span class="token number">20180201</span>'<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
      PARTITION p201802 VALUES <span class="token class-name">LESS</span> THAN <span class="token punctuation">(</span> <span class="token function">TO_DAYS</span><span class="token punctuation">(</span>'<span class="token number">20180301</span>'<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
      PARTITION p201803 VALUES <span class="token class-name">LESS</span> THAN <span class="token punctuation">(</span> <span class="token function">TO_DAYS</span><span class="token punctuation">(</span>'<span class="token number">20180401</span>'<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
      PARTITION p201804 VALUES <span class="token class-name">LESS</span> THAN <span class="token punctuation">(</span> <span class="token function">TO_DAYS</span><span class="token punctuation">(</span>'<span class="token number">20180501</span>'<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
      PARTITION p201805 VALUES <span class="token class-name">LESS</span> THAN <span class="token punctuation">(</span> <span class="token function">TO_DAYS</span><span class="token punctuation">(</span>'<span class="token number">20180601</span>'<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
      PARTITION p201806 VALUES <span class="token class-name">LESS</span> THAN <span class="token punctuation">(</span> <span class="token function">TO_DAYS</span><span class="token punctuation">(</span>'<span class="token number">20180701</span>'<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
      PARTITION p201807 VALUES <span class="token class-name">LESS</span> THAN <span class="token punctuation">(</span> <span class="token function">TO_DAYS</span><span class="token punctuation">(</span>'<span class="token number">20180801</span>'<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
      PARTITION p201808 VALUES <span class="token class-name">LESS</span> THAN <span class="token punctuation">(</span> <span class="token function">TO_DAYS</span><span class="token punctuation">(</span>'<span class="token number">20180901</span>'<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
      PARTITION p201809 VALUES <span class="token class-name">LESS</span> THAN <span class="token punctuation">(</span> <span class="token function">TO_DAYS</span><span class="token punctuation">(</span>'<span class="token number">20181001</span>'<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
      PARTITION p201810 VALUES <span class="token class-name">LESS</span> THAN <span class="token punctuation">(</span> <span class="token function">TO_DAYS</span><span class="token punctuation">(</span>'<span class="token number">20181101</span>'<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
      PARTITION p201811 VALUES <span class="token class-name">LESS</span> THAN <span class="token punctuation">(</span> <span class="token function">TO_DAYS</span><span class="token punctuation">(</span>'<span class="token number">20181201</span>'<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
      PARTITION p201812 VALUES <span class="token class-name">LESS</span> THAN <span class="token punctuation">(</span> <span class="token function">TO_DAYS</span><span class="token punctuation">(</span>'<span class="token number">20190101</span>'<span class="token punctuation">)</span> <span class="token punctuation">)</span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>在<code>/var/lib/mysql/data/</code>可以找到对应的数据文件，每个分区表都有一个使用#分隔命名的表文件：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>   <span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token number">1</span> <span class="token class-name">MySQL</span> <span class="token class-name">MySQL</span>    <span class="token number">65</span> <span class="token class-name">Mar</span> <span class="token number">14</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">47</span> db<span class="token punctuation">.</span>opt
   <span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token number">1</span> <span class="token class-name">MySQL</span> <span class="token class-name">MySQL</span>  <span class="token number">8598</span> <span class="token class-name">Mar</span> <span class="token number">14</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">50</span> test_range_partition<span class="token punctuation">.</span>frm
   <span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token number">1</span> <span class="token class-name">MySQL</span> <span class="token class-name">MySQL</span> <span class="token number">98304</span> <span class="token class-name">Mar</span> <span class="token number">14</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">50</span> test_range_partition#<span class="token class-name">P</span>#p201801<span class="token punctuation">.</span>ibd
   <span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token number">1</span> <span class="token class-name">MySQL</span> <span class="token class-name">MySQL</span> <span class="token number">98304</span> <span class="token class-name">Mar</span> <span class="token number">14</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">50</span> test_range_partition#<span class="token class-name">P</span>#p201802<span class="token punctuation">.</span>ibd
   <span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token number">1</span> <span class="token class-name">MySQL</span> <span class="token class-name">MySQL</span> <span class="token number">98304</span> <span class="token class-name">Mar</span> <span class="token number">14</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">50</span> test_range_partition#<span class="token class-name">P</span>#p201803<span class="token punctuation">.</span>ibd
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>list分区</strong></p> <p>list分区和range分区相似，主要区别在于list是枚举值列表的集合，range是连续的区间值的集合。对于list分区，分区字段必须是已知的，如果插入的字段不在分区时的枚举值中，将无法插入。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>create table test_list_partiotion
   <span class="token punctuation">(</span>
       id <span class="token keyword">int</span> auto_increment<span class="token punctuation">,</span>
       data_type tinyint<span class="token punctuation">,</span>
       primary <span class="token function">key</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>data_type<span class="token punctuation">)</span>
   <span class="token punctuation">)</span>partition by <span class="token function">list</span><span class="token punctuation">(</span>data_type<span class="token punctuation">)</span>
   <span class="token punctuation">(</span>
       partition p0 values in <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       partition p1 values in <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       partition p2 values in <span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">)</span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>hash分区</strong></p> <p>可以将数据均匀地分布到预先定义的分区中。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>create table test_hash_partiotion
   <span class="token punctuation">(</span>
       id <span class="token keyword">int</span> auto_increment<span class="token punctuation">,</span>
       create_date datetime<span class="token punctuation">,</span>
       primary <span class="token function">key</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>create_date<span class="token punctuation">)</span>
   <span class="token punctuation">)</span>partition by <span class="token function">hash</span><span class="token punctuation">(</span><span class="token function">year</span><span class="token punctuation">(</span>create_date<span class="token punctuation">)</span><span class="token punctuation">)</span> partitions <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="分区的问题"><a href="#分区的问题" class="header-anchor">#</a> 分区的问题？</h2> <ol><li>打开和锁住所有底层表的成本可能很高。当查询访问分区表时，MySQL 需要打开并锁住所有的底层表，这个操作在分区过滤之前发生，所以无法通过分区过滤来降低此开销，会影响到查询速度。可以通过批量操作来降低此类开销，比如批量插入、<code>LOAD DATA INFILE</code>和一次删除多行数据。</li> <li>维护分区的成本可能很高。例如重组分区，会先创建一个临时分区，然后将数据复制到其中，最后再删除原分区。</li> <li>所有分区必须使用相同的存储引擎。</li></ol> <h2 id="查询语句执行流程"><a href="#查询语句执行流程" class="header-anchor">#</a> 查询语句执行流程？</h2> <p>查询语句的执行流程如下：权限校验、查询缓存、分析器、优化器、权限校验、执行器、引擎。</p> <p>举个例子，查询语句如下：</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>select * from user where id &gt; 1 and name = '大彬';
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol><li>首先检查权限，没有权限则返回错误；</li> <li>MySQL8.0以前会查询缓存，缓存命中则直接返回，没有则执行下一步；</li> <li>词法分析和语法分析。提取表名、查询条件，检查语法是否有错误；</li> <li>两种执行方案，先查 <code>id &gt; 1</code> 还是 <code>name = '大彬'</code>，优化器根据自己的优化算法选择执行效率最好的方案；</li> <li>校验权限，有权限就调用数据库引擎接口，返回引擎的执行结果。</li></ol> <h2 id="更新语句执行过程"><a href="#更新语句执行过程" class="header-anchor">#</a> 更新语句执行过程？</h2> <p>更新语句执行流程如下：分析器、权限校验、执行器、引擎、<code>redo log</code>（<code>prepare</code>状态）、<code>binlog</code>、<code>redo log</code>（<code>commit</code>状态）</p> <p>举个例子，更新语句如下：</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>update user set name = '大彬' where id = 1;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol><li>先查询到 id 为1的记录，有缓存会使用缓存。</li> <li>拿到查询结果，将 name 更新为大彬，然后调用引擎接口，写入更新数据，innodb 引擎将数据保存在内存中，同时记录<code>redo log</code>，此时<code>redo log</code>进入 <code>prepare</code>状态。</li> <li>执行器收到通知后记录<code>binlog</code>，然后调用引擎接口，提交<code>redo log</code>为<code>commit</code>状态。</li> <li>更新完成。</li></ol> <p>为什么记录完<code>redo log</code>，不直接提交，而是先进入<code>prepare</code>状态？</p> <p>假设先写<code>redo log</code>直接提交，然后写<code>binlog</code>，写完<code>redo log</code>后，机器挂了，<code>binlog</code>日志没有被写入，那么机器重启后，这台机器会通过<code>redo log</code>恢复数据，但是这个时候<code>binlog</code>并没有记录该数据，后续进行机器备份的时候，就会丢失这一条数据，同时主从同步也会丢失这一条数据。</p> <h2 id="exist和in的区别"><a href="#exist和in的区别" class="header-anchor">#</a> exist和in的区别？</h2> <p><code>exists</code>用于对外表记录做筛选。<code>exists</code>会遍历外表，将外查询表的每一行，代入内查询进行判断。当<code>exists</code>里的条件语句能够返回记录行时，条件就为真，返回外表当前记录。反之如果<code>exists</code>里的条件语句不能返回记录行，条件为假，则外表当前记录被丢弃。</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>select a.* from A awhere exists(select 1 from B b where a.id=b.id)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>in</code>是先把后边的语句查出来放到临时表中，然后遍历临时表，将临时表的每一行，代入外查询去查找。</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>select * from Awhere id in(select id from B)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>子查询的表比较大的时候</strong>，使用<code>exists</code>可以有效减少总的循环次数来提升速度；<strong>当外查询的表比较大的时候</strong>，使用<code>in</code>可以有效减少对外查询表循环遍历来提升速度。</p> <h2 id="mysql中int-10-和char-10-的区别"><a href="#mysql中int-10-和char-10-的区别" class="header-anchor">#</a> MySQL中int(10)和char(10)的区别？</h2> <p>int(10)中的10表示的是显示数据的长度，而char(10)表示的是存储数据的长度。</p> <h2 id="truncate、delete与drop区别"><a href="#truncate、delete与drop区别" class="header-anchor">#</a> truncate、delete与drop区别？</h2> <p><strong>相同点：</strong></p> <ol><li><p><code>truncate</code>和不带<code>where</code>子句的<code>delete</code>、以及<code>drop</code>都会删除表内的数据。</p></li> <li><p><code>drop</code>、<code>truncate</code>都是<code>DDL</code>语句（数据定义语言），执行后会自动提交。</p></li></ol> <p><strong>不同点：</strong></p> <ol><li>truncate 和 delete 只删除数据不删除表的结构；drop 语句将删除表的结构被依赖的约束、触发器、索引；</li> <li>一般来说，执行速度: drop &gt; truncate &gt; delete。</li></ol> <h2 id="having和where区别"><a href="#having和where区别" class="header-anchor">#</a> having和where区别？</h2> <ul><li>二者作用的对象不同，<code>where</code>子句作用于表和视图，<code>having</code>作用于组。</li> <li><code>where</code>在数据分组前进行过滤，<code>having</code>在数据分组后进行过滤。</li></ul> <h2 id="什么是mysql主从同步"><a href="#什么是mysql主从同步" class="header-anchor">#</a> 什么是MySQL主从同步？</h2> <p>主从同步使得数据可以从一个数据库服务器复制到其他服务器上，在复制数据时，一个服务器充当主服务器（<code>master</code>），其余的服务器充当从服务器（<code>slave</code>）。</p> <p>因为复制是异步进行的，所以从服务器不需要一直连接着主服务器，从服务器甚至可以通过拨号断断续续地连接主服务器。通过配置文件，可以指定复制所有的数据库，某个数据库，甚至是某个数据库上的某个表。</p> <h2 id="为什么要做主从同步"><a href="#为什么要做主从同步" class="header-anchor">#</a> 为什么要做主从同步？</h2> <ol><li>读写分离，使数据库能支撑更大的并发。</li> <li>在主服务器上生成实时数据，而在从服务器上分析这些数据，从而提高主服务器的性能。</li> <li>数据备份，保证数据的安全。</li></ol> <h2 id="乐观锁和悲观锁是什么"><a href="#乐观锁和悲观锁是什么" class="header-anchor">#</a> 乐观锁和悲观锁是什么？</h2> <p>数据库中的并发控制是确保在多个事务同时存取数据库中同一数据时不破坏事务的隔离性和统一性以及数据库的统一性。乐观锁和悲观锁是并发控制主要采用的技术手段。</p> <ul><li>悲观锁：假定会发生并发冲突，会对操作的数据进行加锁，直到提交事务，才会释放锁，其他事务才能进行修改。实现方式：使用数据库中的锁机制。</li> <li>乐观锁：假设不会发生并发冲突，只在提交操作时检查是否数据是否被修改过。给表增加<code>version</code>字段，在修改提交之前检查<code>version</code>与原来取到的<code>version</code>值是否相等，若相等，表示数据没有被修改，可以更新，否则，数据为脏数据，不能更新。实现方式：乐观锁一般使用版本号机制或<code>CAS</code>算法实现。</li></ul> <h2 id="用过processlist吗"><a href="#用过processlist吗" class="header-anchor">#</a> 用过processlist吗？</h2> <p><code>show processlist</code> 或 <code>show full processlist</code> 可以查看当前 MySQL 是否有压力，正在运行的<code>SQL</code>，有没有慢<code>SQL</code>正在执行。返回参数如下：</p> <ol><li><strong>id</strong>：线程ID，可以用<code>kill id</code>杀死某个线程</li> <li><strong>db</strong>：数据库名称</li> <li><strong>user</strong>：数据库用户</li> <li><strong>host</strong>：数据库实例的IP</li> <li><strong>command</strong>：当前执行的命令，比如<code>Sleep</code>，<code>Query</code>，<code>Connect</code>等</li> <li><strong>time</strong>：消耗时间，单位秒</li> <li><strong>state</strong>：执行状态，主要有以下状态：
<ul><li>Sleep，线程正在等待客户端发送新的请求</li> <li>Locked，线程正在等待锁</li> <li>Sending data，正在处理<code>SELECT</code>查询的记录，同时把结果发送给客户端</li> <li>Kill，正在执行<code>kill</code>语句，杀死指定线程</li> <li>Connect，一个从节点连上了主节点</li> <li>Quit，线程正在退出</li> <li>Sorting for group，正在为<code>GROUP BY</code>做排序</li> <li>Sorting for order，正在为<code>ORDER BY</code>做排序</li></ul></li> <li><strong>info</strong>：正在执行的<code>SQL</code>语句</li></ol> <h2 id="mysql查询-limit-1000-10-和limit-10-速度一样快吗"><a href="#mysql查询-limit-1000-10-和limit-10-速度一样快吗" class="header-anchor">#</a> MySQL查询 limit 1000,10 和limit 10 速度一样快吗？</h2> <p>两种查询方式。对应 <code>limit offset, size</code> 和 <code>limit size</code> 两种方式。</p> <p>而其实 <code>limit size</code> ，相当于  <code>limit 0, size</code>。也就是从0开始取size条数据。</p> <p>也就是说，两种方式的<strong>区别在于offset是否为0。</strong></p> <p>先来看下limit sql的内部执行逻辑。</p> <p>MySQL内部分为<strong>server层</strong>和<strong>存储引擎层</strong>。一般情况下存储引擎都用innodb。</p> <p>server层有很多模块，其中需要关注的是<strong>执行器</strong>是用于跟存储引擎打交道的组件。</p> <p>执行器可以通过调用存储引擎提供的接口，将一行行数据取出，当这些数据完全符合要求（比如满足其他where条件），则会放到<strong>结果集</strong>中，最后返回给调用mysql的<strong>客户端</strong>。</p> <p>以主键索引的limit执行过程为例：</p> <p>执行<code>select * from xxx order by id limit 0, 10;</code>，select后面带的是<strong>星号</strong>，也就是要求获得行数据的<strong>所有字段信息。</strong></p> <p>server层会调用innodb的接口，在innodb里的主键索引中获取到第0到10条<strong>完整行数据</strong>，依次返回给server层，并放到server层的结果集中，返回给客户端。</p> <p>把offset搞大点，比如执行的是：<code>select * from xxx order by id limit 500000, 10;</code></p> <p>server层会调用innodb的接口，由于这次的offset=500000，会在innodb里的主键索引中获取到第0到（500000 + 10）条<strong>完整行数据</strong>，<strong>返回给server层之后根据offset的值挨个抛弃，最后只留下最后面的size条</strong>，也就是10条数据，放到server层的结果集中，返回给客户端。</p> <p>可以看出，当offset非0时，server层会从引擎层获取到<strong>很多无用的数据</strong>，而获取的这些无用数据都是要耗时的。</p> <p>因此，mysql查询中 limit 1000,10 会比 limit 10 更慢。原因是 limit 1000,10 会取出1000+10条数据，并抛弃前1000条，这部分耗时更大。</p> <h2 id="深分页怎么优化"><a href="#深分页怎么优化" class="header-anchor">#</a> 深分页怎么优化？</h2> <p>还是以上面的SQL为空：<code>select * from xxx order by id limit 500000, 10;</code></p> <p><strong>方法一</strong>：</p> <p>从上面的分析可以看出，当offset非常大时，server层会从引擎层获取到很多无用的数据，而当select后面是*号时，就需要拷贝完整的行信息，<strong>拷贝完整数据</strong>相比<strong>只拷贝行数据里的其中一两个列字段</strong>更耗费时间。</p> <p>因为前面的offset条数据最后都是不要的，没有必要拷贝完整字段，所以可以将sql语句修改成：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>select * from xxx  where id &gt;=(select id from xxx order by id limit 500000, 1) order by id limit 10;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>先执行子查询 <code>select id from xxx by id limit 500000, 1</code>, 这个操作，其实也是将在innodb中的主键索引中获取到<code>500000+1</code>条数据，然后server层会抛弃前500000条，只保留最后一条数据的id。</p> <p>但不同的地方在于，在返回server层的过程中，只会拷贝数据行内的id这一列，而不会拷贝数据行的所有列，当数据量较大时，这部分的耗时还是比较明显的。</p> <p>在拿到了上面的id之后，假设这个id正好等于500000，那sql就变成了</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>select * from xxx  where id &gt;=500000 order by id limit 10;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这样innodb再走一次<strong>主键索引</strong>，通过B+树快速定位到id=500000的行数据，时间复杂度是lg(n)，然后向后取10条数据。</p> <p><strong>方法二：</strong></p> <p>将所有的数据<strong>根据id主键进行排序</strong>，然后分批次取，将当前批次的最大id作为下次筛选的条件进行查询。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>select * from xxx where id &gt; start_id order by id limit 10;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>mysql</p> <p>通过主键索引，每次定位到start_id的位置，然后往后遍历10个数据，这样不管数据多大，查询性能都较为稳定。</p> <h2 id="高度为3的b-树-可以存放多少数据"><a href="#高度为3的b-树-可以存放多少数据" class="header-anchor">#</a> 高度为3的B+树，可以存放多少数据？</h2> <p>InnoDB存储引擎有自己的最小储存单元——页（Page）。</p> <p>查询InnoDB页大小的命令如下：</p> <div class="language-mysql line-numbers-mode"><pre class="language-text"><code>mysql&gt; show global status like 'innodb_page_size';
+------------------+-------+
| Variable_name    | Value |
+------------------+-------+
| Innodb_page_size | 16384 |
+------------------+-------+
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>可以看出 innodb 默认的一页大小为 16384B = 16384/1024 = 16kb。</p> <p>在MySQL中，B+树一个节点的大小设为一页或页的倍数最为合适。因为如果一个节点的大小 &lt; 1页，那么读取这个节点的时候其实读取的还是一页，这样就造成了资源的浪费。</p> <p>B+树中<strong>非叶子节点存的是key + 指针</strong>；<strong>叶子节点存的是数据行</strong>。</p> <p>对于叶子节点，如果一行数据大小为1k，那么一页就能存16条数据。</p> <p>对于非叶子节点，如果key使用的是bigint，则为8字节，指针在MySQL中为6字节，一共是14字节，则16k能存放 16 * 1024 / 14 = 1170 个索引指针。</p> <p>于是可以算出，对于一颗高度为2的B+树，根节点存储索引指针节点，那么它有1170个叶子节点存储数据，每个叶子节点可以存储16条数据，一共 1170 x 16 = 18720 条数据。而对于高度为3的B+树，就可以存放 1170 x 1170 x 16 = 21902400 条数据（<strong>两千多万条数据</strong>），也就是对于两千多万条的数据，我们只需要<strong>高度为3</strong>的B+树就可以完成，通过主键查询只需要3次IO操作就能查到对应数据。</p> <p>所以在 InnoDB 中B+树高度一般为3层时，就能满足千万级的数据存储。</p> <p>参考：https://www.cnblogs.com/leefreeman/p/8315844.html</p> <h2 id="mysql单表多大进行分库分表"><a href="#mysql单表多大进行分库分表" class="header-anchor">#</a> MySQL单表多大进行分库分表？</h2> <p>目前主流的有两种说法：</p> <ol><li>MySQL 单表数据量大于 2000 万行，性能会明显下降，考虑进行分库分表。</li> <li>阿里巴巴《Java 开发手册》提出单表行数超过 500 万行或者单表容量超过 2GB，才推荐进行分库分表。</li></ol> <p>事实上，这个数值和实际记录的条数无关，而与 MySQL 的配置以及机器的硬件有关。因为MySQL为了提高性能，会将表的索引装载到内存中。在InnoDB buffer size 足够的情况下，其能完成全加载进内存，查询不会有问题。但是，当单表数据库到达某个量级的上限时，导致内存无法存储其索引，使得之后的 SQL 查询会产生磁盘 IO，从而导致性能下降。当然，这个还有具体的表结构的设计有关，最终导致的问题都是内存限制。</p> <p>因此，对于分库分表，需要结合实际需求，不宜过度设计，在项目一开始不采用分库与分表设计，而是随着业务的增长，在无法继续优化的情况下，再考虑分库与分表提高系统的性能。对此，阿里巴巴《Java 开发手册》补充到：如果预计三年后的数据量根本达不到这个级别，请不要在创建表时就分库分表。</p> <p>至于MySQL单表多大进行分库分表，应当根据机器资源进行评估。</p> <h2 id="大表查询慢怎么优化"><a href="#大表查询慢怎么优化" class="header-anchor">#</a> 大表查询慢怎么优化？</h2> <p>某个表有近千万数据，查询比较慢，如何优化？</p> <p>当MySQL单表记录数过大时，数据库的性能会明显下降，一些常见的优化措施如下：</p> <ul><li>合理建立索引。在合适的字段上建立索引，例如在WHERE和ORDER BY命令上涉及的列建立索引，可根据EXPLAIN来查看是否用了索引还是全表扫描</li> <li>建立分区。对关键字段建立水平分区，比如时间字段，若查询条件往往通过时间范围来进行查询，能提升不少性能</li> <li>利用缓存。利用Redis等缓存热点数据，提高查询效率</li> <li>限定数据的范围。比如：用户在查询历史信息的时候，可以控制在一个月的时间范围内</li> <li>读写分离。经典的数据库拆分方案，主库负责写，从库负责读</li> <li>通过分库分表的方式进行优化，主要有垂直拆分和水平拆分</li></ul> <p><img src="http://img.dabin-coder.cn/image/20220612101342.png" alt=""></p></div> <div class="page-edit"><!----> <span class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/30/2022, 5:55:56 PM</span></span></div> <!----> <!----> </main> <!----></div><div class="global-ui"><div></div><div class="qrcode_container" data-v-131437c0><div class="tencent_code" data-v-131437c0><h4 data-v-131437c0>关注作者公众号</h4> <p data-v-131437c0>和万千小伙伴一起学习</p> <img src="/assets/img/gzh.375c9530.jpg" alt data-v-131437c0></div> <div class="group_code" data-v-131437c0><h4 data-v-131437c0>加入技术交流群</h4> <p data-v-131437c0>扫描二维码 备注<span data-v-131437c0> 技术群</span></p> <img src="/assets/img/wechat.d205276b.jpg" alt data-v-131437c0></div></div><!----><div></div></div></div>
    <script src="/assets/js/app.8b2696d1.js" defer></script><script src="/assets/js/2.d0db0f62.js" defer></script><script src="/assets/js/35.4a8cdbbc.js" defer></script><script src="/assets/js/4.23f6297f.js" defer></script><script src="/assets/js/3.1924df35.js" defer></script>
  </body>
</html>
