(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{648:function(s,a,t){"use strict";t.r(a);var n=t(14),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"存储过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#存储过程"}},[s._v("#")]),s._v(" 存储过程")]),s._v(" "),t("p",[s._v("为以后的使用而保存的一条或多条MySQL语句的集合。可将其视为批文件。\n为什么使用存储过程：")]),s._v(" "),t("ul",[t("li",[s._v("把复杂处理进行封装，简化复杂的操作；")]),s._v(" "),t("li",[s._v("提高性能，存储过程比单独SQL语句更快；")])]),s._v(" "),t("h2",{attrs:{id:"创建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建"}},[s._v("#")]),s._v(" 创建")]),s._v(" "),t("p",[s._v("返回产品平均价格的存储过程：")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CREATE PROCEDURE productpricing() # 可以接受参数\nBEGIN\n\tSELECT Avg(prod_price) AS priceaverage\n\tFROM products;\nEND;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("BEGIN/END 用来限定存储过程体。此段代码仅创建了存储过程，未执行。")]),s._v(" "),t("h2",{attrs:{id:"调用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调用"}},[s._v("#")]),s._v(" 调用")]),s._v(" "),t("p",[t("code",[s._v("CALL productpricing()")])]),s._v(" "),t("h2",{attrs:{id:"删除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除"}},[s._v("#")]),s._v(" 删除")]),s._v(" "),t("p",[s._v("存储过程在创建之后，被保存在服务器上以供使用，直至被删除。\n"),t("code",[s._v("DROP PROCEDURE productpricing IF EXISTS")])]),s._v(" "),t("h2",{attrs:{id:"参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参数"}},[s._v("#")]),s._v(" 参数")]),s._v(" "),t("p",[s._v("MySQL支持IN（传递给存储过程）、OUT（从存储过程传出）和INOUT（对存储过程传入和传出）类型的参数。\n接受订单号并返回该订单的金额：")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CREATE PROCEDURE ordertotal(\n\tIN ordernum INT,\n\tOUT ordersum DECIMAL(8, 2)\n)\nBEGIN\n\tSELECT Sum(item_price * quantity)\n\tFROM orderitems\n\tWHERE order_num = ordernum\n\tINTO ordersum;\nEND;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("调用存储过程："),t("code",[s._v("CALL ordertotal(20, @total);")]),s._v("\n显示订单金额："),t("code",[s._v("SELECT @total;")])]),s._v(" "),t("h2",{attrs:{id:"实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实例"}},[s._v("#")]),s._v(" 实例")]),s._v(" "),t("p",[s._v("获取订单税后金额（订单金额+税收）。")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CREATE PROCEDURE ordertotal(\n\tIN onum INT,\n\tIN taxable BOOLEAN, # 是否计税\n\tOUT ototal DECIMAL(8, 2)\n) COMMENT 'order total, adding tax'\nBEGIN\n\tDECLARE total DECIMAL(8, 2);\n\tDECLARE taxrate INT DEFAULT 6;\n\n\tSELECT Sum(item_price * quanlity)\n\tFROM orderitems\n\tWHERE order_num = onum\n\tINTO total;\n\n\tIF taxable THEN\n\t\tSELECT total + (total / 100 * taxrate) INTO total;\n\tEND IF;\n\t-- SELECT total INTO ototal;\nEND;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("调用存储过程：")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CALL ordertotal(20005, 1, @total);\nSELECT @total;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"查看"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看"}},[s._v("#")]),s._v(" 查看")]),s._v(" "),t("p",[s._v("创建存储过程的 CREATE 语句。")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SHOW CREATE PROCEDURE ordertotal;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("获得包括何时、由谁创建等详细信息的存储过程列表，使用"),t("code",[s._v("SHOW PROCEDURE STATUS LIKE 'ordertotal';")])]),s._v(" "),t("p",[s._v("查看存储过程状态：")]),s._v(" "),t("div",{staticClass:"language-mysql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SHOW PROCEDURE status;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);