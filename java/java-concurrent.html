<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>程序员大彬</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <script>
			var _hmt = _hmt || [];
			(function() {
				var hm = document.createElement("script");
				hm.src = "https://hm.baidu.com/hm.js?f9b36644dd9e756e508a77f272a63e07";
				var s = document.getElementsByTagName("script")[0];
				s.parentNode.insertBefore(hm, s);
			})();
		</script>
    <meta name="description" content="自学转码之路">
    <meta name="baidu-site-verification" content="code-mtJaPDeFwy">
    
    <link rel="preload" href="/assets/css/0.styles.b00f5641.css" as="style"><link rel="preload" href="/assets/js/app.8b2696d1.js" as="script"><link rel="preload" href="/assets/js/2.d0db0f62.js" as="script"><link rel="preload" href="/assets/js/51.0cbece85.js" as="script"><link rel="preload" href="/assets/js/4.23f6297f.js" as="script"><link rel="preload" href="/assets/js/3.1924df35.js" as="script"><link rel="prefetch" href="/assets/js/10.b9d2c267.js"><link rel="prefetch" href="/assets/js/11.a9536795.js"><link rel="prefetch" href="/assets/js/12.637e3c09.js"><link rel="prefetch" href="/assets/js/13.102d093f.js"><link rel="prefetch" href="/assets/js/14.d7307789.js"><link rel="prefetch" href="/assets/js/15.18bb96a8.js"><link rel="prefetch" href="/assets/js/16.1b890605.js"><link rel="prefetch" href="/assets/js/17.25ef6a92.js"><link rel="prefetch" href="/assets/js/18.fa185cc7.js"><link rel="prefetch" href="/assets/js/19.499be2f4.js"><link rel="prefetch" href="/assets/js/20.08f6b86d.js"><link rel="prefetch" href="/assets/js/21.40cb96ce.js"><link rel="prefetch" href="/assets/js/22.2c42b78a.js"><link rel="prefetch" href="/assets/js/23.15469153.js"><link rel="prefetch" href="/assets/js/24.7f6b0e2a.js"><link rel="prefetch" href="/assets/js/25.cbd85eeb.js"><link rel="prefetch" href="/assets/js/26.1ad15ebe.js"><link rel="prefetch" href="/assets/js/27.4eba854b.js"><link rel="prefetch" href="/assets/js/28.e509fb9b.js"><link rel="prefetch" href="/assets/js/29.994dbd5a.js"><link rel="prefetch" href="/assets/js/30.18c1aefb.js"><link rel="prefetch" href="/assets/js/31.c38796f9.js"><link rel="prefetch" href="/assets/js/32.88ef97b8.js"><link rel="prefetch" href="/assets/js/33.a4dfb656.js"><link rel="prefetch" href="/assets/js/34.6de68068.js"><link rel="prefetch" href="/assets/js/35.4a8cdbbc.js"><link rel="prefetch" href="/assets/js/36.0e932c72.js"><link rel="prefetch" href="/assets/js/37.38759ff6.js"><link rel="prefetch" href="/assets/js/38.d822e272.js"><link rel="prefetch" href="/assets/js/39.de685084.js"><link rel="prefetch" href="/assets/js/40.ad41558b.js"><link rel="prefetch" href="/assets/js/41.b01fca4f.js"><link rel="prefetch" href="/assets/js/42.c1253a77.js"><link rel="prefetch" href="/assets/js/43.d2f61e81.js"><link rel="prefetch" href="/assets/js/44.9d432355.js"><link rel="prefetch" href="/assets/js/45.0418c1c2.js"><link rel="prefetch" href="/assets/js/46.184f9783.js"><link rel="prefetch" href="/assets/js/47.569f10e6.js"><link rel="prefetch" href="/assets/js/48.c1409476.js"><link rel="prefetch" href="/assets/js/49.6ad0d80a.js"><link rel="prefetch" href="/assets/js/5.3354b992.js"><link rel="prefetch" href="/assets/js/50.bfb92a00.js"><link rel="prefetch" href="/assets/js/52.add1c509.js"><link rel="prefetch" href="/assets/js/53.57ff55f5.js"><link rel="prefetch" href="/assets/js/54.b79fd09c.js"><link rel="prefetch" href="/assets/js/55.ac4d7936.js"><link rel="prefetch" href="/assets/js/56.66b9e3ef.js"><link rel="prefetch" href="/assets/js/57.e70bf088.js"><link rel="prefetch" href="/assets/js/58.ae1694e7.js"><link rel="prefetch" href="/assets/js/59.5a99d3b1.js"><link rel="prefetch" href="/assets/js/6.6f03b31d.js"><link rel="prefetch" href="/assets/js/60.5f4f38b4.js"><link rel="prefetch" href="/assets/js/61.9d742e56.js"><link rel="prefetch" href="/assets/js/62.670b09f0.js"><link rel="prefetch" href="/assets/js/63.f9f8adca.js"><link rel="prefetch" href="/assets/js/64.aa6ede7d.js"><link rel="prefetch" href="/assets/js/65.5202a37e.js"><link rel="prefetch" href="/assets/js/66.ecb7cc6a.js"><link rel="prefetch" href="/assets/js/67.b08a5c76.js"><link rel="prefetch" href="/assets/js/68.502d67dd.js"><link rel="prefetch" href="/assets/js/69.c5041e73.js"><link rel="prefetch" href="/assets/js/7.77e90ab1.js"><link rel="prefetch" href="/assets/js/70.cd2342e1.js"><link rel="prefetch" href="/assets/js/71.9f448730.js"><link rel="prefetch" href="/assets/js/72.098efb15.js"><link rel="prefetch" href="/assets/js/73.da7342aa.js"><link rel="prefetch" href="/assets/js/74.98f3211b.js"><link rel="prefetch" href="/assets/js/75.4e6ffa8f.js"><link rel="prefetch" href="/assets/js/8.8d940901.js"><link rel="prefetch" href="/assets/js/9.dc8d7aad.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b00f5641.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">程序员大彬</span></a> <nav class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <ul class="nav-links can-hide"><li class="nav-item"><a href="/" class="nav-link"><!----> <span>主页</span></a></li><li class="nav-item"><a href="https://docs.qq.com/sheet/DYW9ObnpobXNRTXpq" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>​秋招来啦（内推）</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title">
      Java
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><!----> <span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/java-basic.html" class="nav-link"><!----> <span>基础</span></a></li><li class="dropdown-item"><!----> <a href="/java/java-collection.html" class="nav-link"><!----> <span>集合</span></a></li><li class="dropdown-item"><!----> <a href="/java/java-concurrent.html" aria-current="page" class="nav-link router-link-exact-active router-link-active"><!----> <span>并发</span></a></li><li class="dropdown-item"><!----> <a href="/java/jvm.html" class="nav-link"><!----> <span>JVM</span></a></li><li class="dropdown-item"><!----> <a href="/java/java8.html" class="nav-link"><!----> <span>Java8新特性</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架中间件" class="dropdown-title"><!----> <span class="title">
      框架中间件
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="框架中间件" class="mobile-dropdown-title"><!----> <span class="title">框架中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/spring.html" class="nav-link"><!----> <span>Spring面试题</span></a></li><li class="dropdown-subitem"><a href="/framework/springmvc.html" class="nav-link"><!----> <span>SpringMVC面试题</span></a></li><li class="dropdown-subitem"><a href="/framework/mybatis.html" class="nav-link"><!----> <span>Mybatis面试题</span></a></li><li class="dropdown-subitem"><a href="/framework/springboot.html" class="nav-link"><!----> <span>SpringBoot面试题</span></a></li><li class="dropdown-subitem"><a href="/framework/springcloud-overview.html" class="nav-link"><!----> <span>SpringCloud详解</span></a></li><li class="dropdown-subitem"><a href="/framework/netty-overview.html" class="nav-link"><!----> <span>Netty详解</span></a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/message-queue/mq.html" class="nav-link"><!----> <span>消息队列面试题</span></a></li><li class="dropdown-subitem"><a href="/message-queue/rabbitmq.html" class="nav-link"><!----> <span>RabbitMQ面试题</span></a></li></ul></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><!----> <span class="title">
      计算机基础
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><!----> <span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computer-basic/network.html" class="nav-link"><!----> <span>网络</span></a></li><li class="dropdown-item"><!----> <a href="/computer-basic/operate-system.html" class="nav-link"><!----> <span>操作系统</span></a></li><li class="dropdown-item"><!----> <a href="/computer-basic/algorithm.html" class="nav-link"><!----> <span>算法</span></a></li><li class="dropdown-item"><!----> <a href="/computer-basic/data-structure.html" class="nav-link"><!----> <span>数据结构</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title">
      数据库
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><!----> <span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          关系型数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/mysql-basic/" class="nav-link"><!----> <span>MySQL基础</span></a></li><li class="dropdown-subitem"><a href="/database/mysql.html" class="nav-link"><!----> <span>MySQL面试题</span></a></li><li class="dropdown-subitem"><a href="/database/mysql-execution-plan.html" class="nav-link"><!----> <span>MySQL执行计划详解</span></a></li></ul></li><li class="dropdown-item"><h4>
          非关系型数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/redis/redis-basic.html" class="nav-link"><!----> <span>Redis基础</span></a></li><li class="dropdown-subitem"><a href="/redis/redis.html" class="nav-link"><!----> <span>Redis面试题</span></a></li><li class="dropdown-subitem"><a href="https://mp.weixin.qq.com/s/Ffb8NDgavf9QAWYBm0qAVg" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>ElasticSearch面试题</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><!----> <span class="title">
      分布式
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式" class="mobile-dropdown-title"><!----> <span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/distributed/global-unique-id.html" class="nav-link"><!----> <span>全局唯一ID</span></a></li><li class="dropdown-item"><!----> <a href="/distributed/distributed-lock.html" class="nav-link"><!----> <span>分布式锁</span></a></li><li class="dropdown-item"><!----> <a href="/distributed/rpc.html" class="nav-link"><!----> <span>RPC</span></a></li><li class="dropdown-item"><!----> <a href="/distributed/micro-service.html" class="nav-link"><!----> <span>微服务</span></a></li><li class="dropdown-item"><!----> <a href="/distributed/distributed-transaction.html" class="nav-link"><!----> <span>分布式事务</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程内功" class="dropdown-title"><!----> <span class="title">
      编程内功
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="编程内功" class="mobile-dropdown-title"><!----> <span class="title">编程内功</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advance/design-pattern.html" class="nav-link"><!----> <span>设计模式</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="场景题&amp;系统设计" class="dropdown-title"><!----> <span class="title">
      场景题&amp;系统设计
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="场景题&amp;系统设计" class="mobile-dropdown-title"><!----> <span class="title">场景题&amp;系统设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          海量数据
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mass-data/count-phone-num.html" class="nav-link"><!----> <span>统计不同号码的个数</span></a></li><li class="dropdown-subitem"><a href="/mass-data/find-hign-frequency-word.html" class="nav-link"><!----> <span>出现频率最高的100个词</span></a></li></ul></li><li class="dropdown-item"><h4>
          系统设计
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/system-design/scan-code-login.html" class="nav-link"><!----> <span>扫码登录设计</span></a></li></ul></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><!----> <span class="title">
      工具
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><!----> <span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          开发工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/git-overview.html" class="nav-link"><!----> <span>Git详解</span></a></li><li class="dropdown-subitem"><a href="/tools/maven-overview.html" class="nav-link"><!----> <span>Maven详解</span></a></li><li class="dropdown-subitem"><a href="https://mp.weixin.qq.com/s/ATkZwtw4EF9erGJ4PamTjQ" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>Docker详解</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://mp.weixin.qq.com/s/SKKEeYxif0wWJo6n57rd6A" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>Nginx面试题</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://mp.weixin.qq.com/s/GbTaa3_qs1KvgUD3S2307w" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>Linux常用命令</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          编程利器
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/typora-overview.html" class="nav-link"><!----> <span>markdown编辑器</span></a></li></ul></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习资源" class="dropdown-title"><!----> <span class="title">
      学习资源
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="学习资源" class="mobile-dropdown-title"><!----> <span class="title">学习资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          学习资源
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/Tyson0314/java-books" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>计算机经典电子书PDF</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="/learning-resources/leetcode-note.html" class="nav-link"><!----> <span>Leetcode刷题笔记</span></a></li></ul></li><li class="dropdown-item"><h4>
          学习路线
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learning-resources/java-learn-guide.html" class="nav-link"><!----> <span>Java学习路线</span></a></li><li class="dropdown-subitem"><a href="/learning-resources/cs-learn-guide.html" class="nav-link"><!----> <span>CS学习路线</span></a></li></ul></li></ul></div></li><li class="nav-item"><a href="/other/site-diary.html" class="nav-link"><!----> <span>网站日记</span></a></li> <li class="nav-item"><a href="undefinedundefined/" target="_blank" rel="noopener noreferrer"><!----> <span></span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="theme-switcher"><a class="switch light"><span><i aria-hidden="true" class="fa fa-sun"></i></span></a></div></nav></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <ul class="nav-links"><li class="nav-item"><a href="/" class="nav-link"><!----> <span>主页</span></a></li><li class="nav-item"><a href="https://docs.qq.com/sheet/DYW9ObnpobXNRTXpq" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>​秋招来啦（内推）</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title">
      Java
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><!----> <span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/java-basic.html" class="nav-link"><!----> <span>基础</span></a></li><li class="dropdown-item"><!----> <a href="/java/java-collection.html" class="nav-link"><!----> <span>集合</span></a></li><li class="dropdown-item"><!----> <a href="/java/java-concurrent.html" aria-current="page" class="nav-link router-link-exact-active router-link-active"><!----> <span>并发</span></a></li><li class="dropdown-item"><!----> <a href="/java/jvm.html" class="nav-link"><!----> <span>JVM</span></a></li><li class="dropdown-item"><!----> <a href="/java/java8.html" class="nav-link"><!----> <span>Java8新特性</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架中间件" class="dropdown-title"><!----> <span class="title">
      框架中间件
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="框架中间件" class="mobile-dropdown-title"><!----> <span class="title">框架中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/spring.html" class="nav-link"><!----> <span>Spring面试题</span></a></li><li class="dropdown-subitem"><a href="/framework/springmvc.html" class="nav-link"><!----> <span>SpringMVC面试题</span></a></li><li class="dropdown-subitem"><a href="/framework/mybatis.html" class="nav-link"><!----> <span>Mybatis面试题</span></a></li><li class="dropdown-subitem"><a href="/framework/springboot.html" class="nav-link"><!----> <span>SpringBoot面试题</span></a></li><li class="dropdown-subitem"><a href="/framework/springcloud-overview.html" class="nav-link"><!----> <span>SpringCloud详解</span></a></li><li class="dropdown-subitem"><a href="/framework/netty-overview.html" class="nav-link"><!----> <span>Netty详解</span></a></li></ul></li><li class="dropdown-item"><h4>
          消息队列
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/message-queue/mq.html" class="nav-link"><!----> <span>消息队列面试题</span></a></li><li class="dropdown-subitem"><a href="/message-queue/rabbitmq.html" class="nav-link"><!----> <span>RabbitMQ面试题</span></a></li></ul></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><!----> <span class="title">
      计算机基础
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><!----> <span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computer-basic/network.html" class="nav-link"><!----> <span>网络</span></a></li><li class="dropdown-item"><!----> <a href="/computer-basic/operate-system.html" class="nav-link"><!----> <span>操作系统</span></a></li><li class="dropdown-item"><!----> <a href="/computer-basic/algorithm.html" class="nav-link"><!----> <span>算法</span></a></li><li class="dropdown-item"><!----> <a href="/computer-basic/data-structure.html" class="nav-link"><!----> <span>数据结构</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title">
      数据库
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><!----> <span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          关系型数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/mysql-basic/" class="nav-link"><!----> <span>MySQL基础</span></a></li><li class="dropdown-subitem"><a href="/database/mysql.html" class="nav-link"><!----> <span>MySQL面试题</span></a></li><li class="dropdown-subitem"><a href="/database/mysql-execution-plan.html" class="nav-link"><!----> <span>MySQL执行计划详解</span></a></li></ul></li><li class="dropdown-item"><h4>
          非关系型数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/redis/redis-basic.html" class="nav-link"><!----> <span>Redis基础</span></a></li><li class="dropdown-subitem"><a href="/redis/redis.html" class="nav-link"><!----> <span>Redis面试题</span></a></li><li class="dropdown-subitem"><a href="https://mp.weixin.qq.com/s/Ffb8NDgavf9QAWYBm0qAVg" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>ElasticSearch面试题</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><!----> <span class="title">
      分布式
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式" class="mobile-dropdown-title"><!----> <span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/distributed/global-unique-id.html" class="nav-link"><!----> <span>全局唯一ID</span></a></li><li class="dropdown-item"><!----> <a href="/distributed/distributed-lock.html" class="nav-link"><!----> <span>分布式锁</span></a></li><li class="dropdown-item"><!----> <a href="/distributed/rpc.html" class="nav-link"><!----> <span>RPC</span></a></li><li class="dropdown-item"><!----> <a href="/distributed/micro-service.html" class="nav-link"><!----> <span>微服务</span></a></li><li class="dropdown-item"><!----> <a href="/distributed/distributed-transaction.html" class="nav-link"><!----> <span>分布式事务</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程内功" class="dropdown-title"><!----> <span class="title">
      编程内功
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="编程内功" class="mobile-dropdown-title"><!----> <span class="title">编程内功</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advance/design-pattern.html" class="nav-link"><!----> <span>设计模式</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="场景题&amp;系统设计" class="dropdown-title"><!----> <span class="title">
      场景题&amp;系统设计
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="场景题&amp;系统设计" class="mobile-dropdown-title"><!----> <span class="title">场景题&amp;系统设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          海量数据
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mass-data/count-phone-num.html" class="nav-link"><!----> <span>统计不同号码的个数</span></a></li><li class="dropdown-subitem"><a href="/mass-data/find-hign-frequency-word.html" class="nav-link"><!----> <span>出现频率最高的100个词</span></a></li></ul></li><li class="dropdown-item"><h4>
          系统设计
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/system-design/scan-code-login.html" class="nav-link"><!----> <span>扫码登录设计</span></a></li></ul></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><!----> <span class="title">
      工具
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><!----> <span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          开发工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/git-overview.html" class="nav-link"><!----> <span>Git详解</span></a></li><li class="dropdown-subitem"><a href="/tools/maven-overview.html" class="nav-link"><!----> <span>Maven详解</span></a></li><li class="dropdown-subitem"><a href="https://mp.weixin.qq.com/s/ATkZwtw4EF9erGJ4PamTjQ" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>Docker详解</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://mp.weixin.qq.com/s/SKKEeYxif0wWJo6n57rd6A" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>Nginx面试题</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://mp.weixin.qq.com/s/GbTaa3_qs1KvgUD3S2307w" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>Linux常用命令</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          编程利器
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/typora-overview.html" class="nav-link"><!----> <span>markdown编辑器</span></a></li></ul></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习资源" class="dropdown-title"><!----> <span class="title">
      学习资源
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="学习资源" class="mobile-dropdown-title"><!----> <span class="title">学习资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          学习资源
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/Tyson0314/java-books" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>计算机经典电子书PDF</span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="/learning-resources/leetcode-note.html" class="nav-link"><!----> <span>Leetcode刷题笔记</span></a></li></ul></li><li class="dropdown-item"><h4>
          学习路线
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learning-resources/java-learn-guide.html" class="nav-link"><!----> <span>Java学习路线</span></a></li><li class="dropdown-subitem"><a href="/learning-resources/cs-learn-guide.html" class="nav-link"><!----> <span>CS学习路线</span></a></li></ul></li></ul></div></li><li class="nav-item"><a href="/other/site-diary.html" class="nav-link"><!----> <span>网站日记</span></a></li> <li class="nav-item"><a href="undefinedundefined/" target="_blank" rel="noopener noreferrer"><!----> <span></span> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><i></i> <span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/java-concurrent.html#线程池" class="sidebar-link">线程池</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#为什么平时都是使用线程池创建线程-直接new一个线程不好吗" class="sidebar-link">为什么平时都是使用线程池创建线程，直接new一个线程不好吗？</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#为什么使用线程池" class="sidebar-link">为什么使用线程池？</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#线程池执行原理" class="sidebar-link">线程池执行原理？</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#线程池参数有哪些" class="sidebar-link">线程池参数有哪些？</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#线程池大小怎么设置" class="sidebar-link">线程池大小怎么设置？</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#线程池的类型有哪些-适用场景" class="sidebar-link">线程池的类型有哪些？适用场景？</a></li></ul></li><li><a href="/java/java-concurrent.html#进程线程" class="sidebar-link">进程线程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#线程的生命周期" class="sidebar-link">线程的生命周期</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#讲讲线程中断" class="sidebar-link">讲讲线程中断？</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#创建线程有哪几种方式" class="sidebar-link">创建线程有哪几种方式？</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#什么是线程死锁" class="sidebar-link">什么是线程死锁？</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#线程死锁怎么产生-怎么避免" class="sidebar-link">线程死锁怎么产生？怎么避免？</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#线程run和start的区别" class="sidebar-link">线程run和start的区别？</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#线程都有哪些方法" class="sidebar-link">线程都有哪些方法？</a></li></ul></li><li><a href="/java/java-concurrent.html#volatile底层原理" class="sidebar-link">volatile底层原理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#synchronized的用法有哪些" class="sidebar-link">synchronized的用法有哪些?</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#synchronized的作用有哪些" class="sidebar-link">synchronized的作用有哪些？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#synchronized-底层实现原理" class="sidebar-link">synchronized 底层实现原理？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#volatile和synchronized的区别是什么" class="sidebar-link">volatile和synchronized的区别是什么？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#reentrantlock和synchronized区别" class="sidebar-link">ReentrantLock和synchronized区别</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#wait-和sleep-的异同点" class="sidebar-link">wait()和sleep()的异同点？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#runnable和callable有什么区别" class="sidebar-link">Runnable和Callable有什么区别？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#线程执行顺序怎么控制" class="sidebar-link">线程执行顺序怎么控制？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#守护线程是什么" class="sidebar-link">守护线程是什么？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#线程间通信方式" class="sidebar-link">线程间通信方式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#threadlocal" class="sidebar-link">ThreadLocal</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#threadlocal原理" class="sidebar-link">ThreadLocal原理</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#threadlocal内存泄漏的原因" class="sidebar-link">ThreadLocal内存泄漏的原因？</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#threadlocal使用场景有哪些" class="sidebar-link">ThreadLocal使用场景有哪些？</a></li></ul></li><li><a href="/java/java-concurrent.html#aqs原理" class="sidebar-link">AQS原理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#reentrantlock-是如何实现可重入性的" class="sidebar-link">ReentrantLock 是如何实现可重入性的?</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#锁的分类" class="sidebar-link">锁的分类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#公平锁与非公平锁" class="sidebar-link">公平锁与非公平锁</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#共享式与独占式锁" class="sidebar-link">共享式与独占式锁</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#悲观锁与乐观锁" class="sidebar-link">悲观锁与乐观锁</a></li></ul></li><li><a href="/java/java-concurrent.html#乐观锁有什么问题" class="sidebar-link">乐观锁有什么问题?</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#什么是cas" class="sidebar-link">什么是CAS？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#cas存在的问题" class="sidebar-link">CAS存在的问题？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#并发工具" class="sidebar-link">并发工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#countdownlatch" class="sidebar-link">CountDownLatch</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#cyclicbarrier" class="sidebar-link">CyclicBarrier</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#cyclicbarrier和countdownlatch区别" class="sidebar-link">CyclicBarrier和CountDownLatch区别</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#semaphore" class="sidebar-link">Semaphore</a></li></ul></li><li><a href="/java/java-concurrent.html#原子类" class="sidebar-link">原子类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#基本类型原子类" class="sidebar-link">基本类型原子类</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#数组类型原子类" class="sidebar-link">数组类型原子类</a></li><li class="sidebar-sub-header"><a href="/java/java-concurrent.html#引用类型原子类" class="sidebar-link">引用类型原子类</a></li></ul></li><li><a href="/java/java-concurrent.html#为什么要使用executor线程池框架呢" class="sidebar-link">为什么要使用Executor线程池框架呢？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#如何停止一个正在运行的线程" class="sidebar-link">如何停止一个正在运行的线程？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#什么是daemon线程" class="sidebar-link">什么是Daemon线程？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#synchronizedmap和concurrenthashmap有什么区别" class="sidebar-link">SynchronizedMap和ConcurrentHashMap有什么区别？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java-concurrent.html#怎么判断线程池的任务是不是执行完了" class="sidebar-link">怎么判断线程池的任务是不是执行完了？</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-vpx-content content__default"><p><img src="http://img.dabin-coder.cn/image/%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93.jpg" alt=""></p> <h2 id="线程池"><a href="#线程池" class="header-anchor">#</a> 线程池</h2> <p>线程池：一个管理线程的池子。</p> <h3 id="为什么平时都是使用线程池创建线程-直接new一个线程不好吗"><a href="#为什么平时都是使用线程池创建线程-直接new一个线程不好吗" class="header-anchor">#</a> 为什么平时都是使用线程池创建线程，直接new一个线程不好吗？</h3> <p>嗯，手动创建线程有两个缺点</p> <ol><li>不受控风险</li> <li>频繁创建开销大</li></ol> <p><strong>为什么不受控</strong>？</p> <p>系统资源有限，每个人针对不同业务都可以手动创建线程，并且创建线程没有统一标准，比如创建的线程有没有名字等。当系统运行起来，所有线程都在抢占资源，毫无规则，混乱场面可想而知，不好管控。</p> <p><strong>频繁手动创建线程为什么开销会大？跟new Object() 有什么差别？</strong></p> <p>虽然Java中万物皆对象，但是new Thread() 创建一个线程和 new Object()还是有区别的。</p> <p>new Object()过程如下：</p> <ol><li>JVM分配一块内存 M</li> <li>在内存 M 上初始化该对象</li> <li>将内存 M 的地址赋值给引用变量 obj</li></ol> <p>创建线程的过程如下：</p> <ol><li>JVM为一个线程栈分配内存，该栈为每个线程方法调用保存一个栈帧</li> <li>每一栈帧由一个局部变量数组、返回值、操作数堆栈和常量池组成</li> <li>每个线程获得一个程序计数器，用于记录当前虚拟机正在执行的线程指令地址</li> <li>系统创建一个与Java线程对应的本机线程</li> <li>将与线程相关的描述符添加到JVM内部数据结构中</li> <li>线程共享堆和方法区域</li></ol> <p>创建一个线程大概需要1M左右的空间（Java8，机器规格2c8G）。可见，频繁手动创建/销毁线程的代价是非常大的。</p> <h3 id="为什么使用线程池"><a href="#为什么使用线程池" class="header-anchor">#</a> 为什么使用线程池？</h3> <ul><li><strong>降低资源消耗</strong>。通过重复利用已创建的线程降低线程创建和销毁造成的消耗。</li> <li><strong>提高响应速度</strong>。当任务到达时，可以不需要等到线程创建就能立即执行。</li> <li><strong>提高线程的可管理性</strong>。统一管理线程，避免系统创建大量同类线程而导致消耗完内存。</li></ul> <h3 id="线程池执行原理"><a href="#线程池执行原理" class="header-anchor">#</a> 线程池执行原理？</h3> <p><img src="http://img.dabin-coder.cn/image/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.png" alt="线程池执行流程"></p> <ol><li>当线程池里存活的线程数小于核心线程数<code>corePoolSize</code>时，这时对于一个新提交的任务，线程池会创建一个线程去处理任务。当线程池里面存活的线程数小于等于核心线程数<code>corePoolSize</code>时，线程池里面的线程会一直存活着，就算空闲时间超过了<code>keepAliveTime</code>，线程也不会被销毁，而是一直阻塞在那里一直等待任务队列的任务来执行。</li> <li>当线程池里面存活的线程数已经等于corePoolSize了，这是对于一个新提交的任务，会被放进任务队列workQueue排队等待执行。</li> <li>当线程池里面存活的线程数已经等于<code>corePoolSize</code>了，并且任务队列也满了，假设<code>maximumPoolSize&gt;corePoolSize</code>，这时如果再来新的任务，线程池就会继续创建新的线程来处理新的任务，知道线程数达到<code>maximumPoolSize</code>，就不会再创建了。</li> <li>如果当前的线程数达到了<code>maximumPoolSize</code>，并且任务队列也满了，如果还有新的任务过来，那就直接采用拒绝策略进行处理。默认的拒绝策略是抛出一个RejectedExecutionException异常。</li></ol> <h3 id="线程池参数有哪些"><a href="#线程池参数有哪些" class="header-anchor">#</a> 线程池参数有哪些？</h3> <p>ThreadPoolExecutor 的通用构造函数：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>1、<code>corePoolSize</code>：当有新任务时，如果线程池中线程数没有达到线程池的基本大小，则会创建新的线程执行任务，否则将任务放入阻塞队列。当线程池中存活的线程数总是大于 corePoolSize 时，应该考虑调大 corePoolSize。</p> <p>2、<code>maximumPoolSize</code>：当阻塞队列填满时，如果线程池中线程数没有超过最大线程数，则会创建新的线程运行任务。否则根据拒绝策略处理新任务。非核心线程类似于临时借来的资源，这些线程在空闲时间超过 keepAliveTime 之后，就应该退出，避免资源浪费。</p> <p>3、<code>BlockingQueue</code>：存储等待运行的任务。</p> <p>4、<code>keepAliveTime</code>：<strong>非核心线程</strong>空闲后，保持存活的时间，此参数只对非核心线程有效。设置为0，表示多余的空闲线程会被立即终止。</p> <p>5、<code>TimeUnit</code>：时间单位</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>DAYS
<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>HOURS
<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES
<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS
<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS
<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MICROSECONDS
<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>NANOSECONDS
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>6、<code>ThreadFactory</code>：每当线程池创建一个新的线程时，都是通过线程工厂方法来完成的。在 ThreadFactory 中只定义了一个方法 newThread，每当线程池需要创建新线程就会调用它。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThreadFactory</span> <span class="token keyword">implements</span> <span class="token class-name">ThreadFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> poolName<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">MyThreadFactory</span><span class="token punctuation">(</span><span class="token class-name">String</span> poolName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>poolName <span class="token operator">=</span> poolName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Thread</span> <span class="token function">newThread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> runnable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyAppThread</span><span class="token punctuation">(</span>runnable<span class="token punctuation">,</span> poolName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将线程池名字传递给构造函数，用于区分不同线程池的线程</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>7、<code>RejectedExecutionHandler</code>：当队列和线程池都满了的时候，根据拒绝策略处理新任务。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">AbortPolicy</span>：默认的策略，直接抛出<span class="token class-name">RejectedExecutionException</span>
<span class="token class-name">DiscardPolicy</span>：不处理，直接丢弃
<span class="token class-name">DiscardOldestPolicy</span>：将等待队列队首的任务丢弃，并执行当前任务
<span class="token class-name">CallerRunsPolicy</span>：由调用线程处理该任务
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="线程池大小怎么设置"><a href="#线程池大小怎么设置" class="header-anchor">#</a> 线程池大小怎么设置？</h3> <p>如果线程池线程数量太小，当有大量请求需要处理，系统响应比较慢，会影响用户体验，甚至会出现任务队列大量堆积任务导致OOM。</p> <p>如果线程池线程数量过大，大量线程可能会同时抢占 CPU 资源，这样会导致大量的上下文切换，从而增加线程的执行时间，影响了执行效率。</p> <p><strong>CPU 密集型任务(N+1)</strong>： 这种任务消耗的主要是 CPU 资源，可以将线程数设置为<code>N（CPU 核心数）+1</code>，多出来的一个线程是为了防止某些原因导致的线程阻塞（如IO操作，线程sleep，等待锁）而带来的影响。一旦某个线程被阻塞，释放了CPU资源，而在这种情况下多出来的一个线程就可以充分利用 CPU 的空闲时间。</p> <p><strong>I/O 密集型任务(2N)</strong>： 系统的大部分时间都在处理 IO 操作，此时线程可能会被阻塞，释放CPU资源，这时就可以将 CPU 交出给其它线程使用。因此在 IO 密集型任务的应用中，可以多配置一些线程，具体的计算方法：<code>最佳线程数 = CPU核心数 * (1/CPU利用率) = CPU核心数 * (1 + (IO耗时/CPU耗时))</code>，一般可设置为2N。</p> <h3 id="线程池的类型有哪些-适用场景"><a href="#线程池的类型有哪些-适用场景" class="header-anchor">#</a> 线程池的类型有哪些？适用场景？</h3> <p>常见的线程池有 <code>FixedThreadPool</code>、<code>SingleThreadExecutor</code>、<code>CachedThreadPool</code> 和 <code>ScheduledThreadPool</code>。这几个都是 <code>ExecutorService</code> 线程池实例。</p> <p><strong>FixedThreadPool</strong></p> <p>固定线程数的线程池。任何时间点，最多只有 nThreads 个线程处于活动状态执行任务。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static ExecutorService newFixedThreadPool(int nThreads) {
	return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;());
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>使用无界队列 LinkedBlockingQueue（队列容量为 Integer.MAX_VALUE），运行中的线程池不会拒绝任务，即不会调用RejectedExecutionHandler.rejectedExecution()方法。</p> <p>maxThreadPoolSize 是无效参数，故将它的值设置为与 coreThreadPoolSize 一致。</p> <p>keepAliveTime 也是无效参数，设置为0L，因为此线程池里所有线程都是核心线程，核心线程不会被回收（除非设置了executor.allowCoreThreadTimeOut(true)）。</p> <p>适用场景：适用于处理CPU密集型的任务，确保CPU在长期被工作线程使用的情况下，尽可能的少的分配线程，即适用执行长期的任务。需要注意的是，FixedThreadPool 不会拒绝任务，<strong>在任务比较多的时候会导致 OOM。</strong></p> <p><strong>SingleThreadExecutor</strong></p> <p>只有一个线程的线程池。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static ExecutionService newSingleThreadExecutor() {
	return new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;());
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>使用无界队列 LinkedBlockingQueue。线程池只有一个运行的线程，新来的任务放入工作队列，线程处理完任务就循环从队列里获取任务执行。保证顺序的执行各个任务。</p> <p>适用场景：适用于串行执行任务的场景，一个任务一个任务地执行。<strong>在任务比较多的时候也是会导致 OOM。</strong></p> <p><strong>CachedThreadPool</strong></p> <p>根据需要创建新线程的线程池。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static ExecutorService newCachedThreadPool() {
	return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;());
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果主线程提交任务的速度高于线程处理任务的速度时，<code>CachedThreadPool</code> 会不断创建新的线程。极端情况下，这样会导致耗尽 cpu 和内存资源。</p> <p>使用没有容量的SynchronousQueue作为线程池工作队列，当线程池有空闲线程时，<code>SynchronousQueue.offer(Runnable task)</code>提交的任务会被空闲线程处理，否则会创建新的线程处理任务。</p> <p>适用场景：用于并发执行大量短期的小任务。<code>CachedThreadPool</code>允许创建的线程数量为 Integer.MAX_VALUE ，<strong>可能会创建大量线程，从而导致 OOM。</strong></p> <p><strong>ScheduledThreadPoolExecutor</strong></p> <p>在给定的延迟后运行任务，或者定期执行任务。在实际项目中基本不会被用到，因为有其他方案选择比如<code>quartz</code>。</p> <p>使用的任务队列 <code>DelayQueue</code> 封装了一个 <code>PriorityQueue</code>，<code>PriorityQueue</code> 会对队列中的任务进行排序，时间早的任务先被执行(即<code>ScheduledFutureTask</code> 的 <code>time</code> 变量小的先执行)，如果time相同则先提交的任务会被先执行(<code>ScheduledFutureTask</code> 的 <code>squenceNumber</code> 变量小的先执行)。</p> <p>执行周期任务步骤：</p> <ol><li>线程从 <code>DelayQueue</code> 中获取已到期的 <code>ScheduledFutureTask（DelayQueue.take()）</code>。到期任务是指 <code>ScheduledFutureTask</code>的 time 大于等于当前系统的时间；</li> <li>执行这个 <code>ScheduledFutureTask</code>；</li> <li>修改 <code>ScheduledFutureTask</code> 的 time 变量为下次将要被执行的时间；</li> <li>把这个修改 time 之后的 <code>ScheduledFutureTask</code> 放回 <code>DelayQueue</code> 中（<code>DelayQueue.add()</code>)。</li></ol> <p><img src="http://img.dabin-coder.cn/image/scheduled-task.jpg" alt=""></p> <p>适用场景：周期性执行任务的场景，需要限制线程数量的场景。</p> <h2 id="进程线程"><a href="#进程线程" class="header-anchor">#</a> 进程线程</h2> <p>进程是指一个内存中运行的应用程序，每个进程都有自己独立的一块内存空间。</p> <p>线程是比进程更小的执行单位，它是在一个进程中独立的控制流，一个进程可以启动多个线程，每条线程并行执行不同的任务。</p> <h3 id="线程的生命周期"><a href="#线程的生命周期" class="header-anchor">#</a> 线程的生命周期</h3> <p><strong>初始(NEW)</strong>：线程被构建，还没有调用 start()。</p> <p><strong>运行(RUNNABLE)</strong>：包括操作系统的就绪和运行两种状态。</p> <p><strong>阻塞(BLOCKED)</strong>：一般是被动的，在抢占资源中得不到资源，被动的挂起在内存，等待资源释放将其唤醒。线程被阻塞会释放CPU，不释放内存。</p> <p><strong>等待(WAITING)</strong>：进入该状态的线程需要等待其他线程做出一些特定动作（通知或中断）。</p> <p><strong>超时等待(TIMED_WAITING)</strong>：该状态不同于WAITING，它可以在指定的时间后自行返回。</p> <p><strong>终止(TERMINATED)</strong>：表示该线程已经执行完毕。</p> <p><img src="http://img.dabin-coder.cn/image/image-20210909235618175.png" alt=""></p> <blockquote><p>图片来源：Java并发编程的艺术</p></blockquote> <h3 id="讲讲线程中断"><a href="#讲讲线程中断" class="header-anchor">#</a> 讲讲线程中断？</h3> <p>线程中断即线程运行过程中被其他线程给打断了，它与 stop 最大的区别是：stop 是由系统强制终止线程，而线程中断则是给目标线程发送一个中断信号，如果目标线程没有接收线程中断的信号并结束线程，线程则不会终止，具体是否退出或者执行其他逻辑取决于目标线程。</p> <p>线程中断三个重要的方法：</p> <p><strong>1、java.lang.Thread#interrupt</strong></p> <p>调用目标线程的<code>interrupt()</code>方法，给目标线程发一个中断信号，线程被打上中断标记。</p> <p><strong>2、java.lang.Thread#isInterrupted()</strong></p> <p>判断目标线程是否被中断，不会清除中断标记。</p> <p><strong>3、java.lang.Thread#interrupted</strong></p> <p>判断目标线程是否被中断，会清除中断标记。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 响应中断</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Java技术栈线程被中断，程序退出。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="创建线程有哪几种方式"><a href="#创建线程有哪几种方式" class="header-anchor">#</a> 创建线程有哪几种方式？</h3> <ul><li>通过扩展<code>Thread</code>类来创建多线程</li> <li>通过实现<code>Runnable</code>接口来创建多线程</li> <li>实现<code>Callable</code>接口，通过<code>FutureTask</code>接口创建线程。</li> <li>使用<code>Executor</code>框架来创建线程池。</li></ul> <p><strong>继承 Thread 创建线程</strong>代码如下。run()方法是由jvm创建完操作系统级线程后回调的方法，不可以手动调用，手动调用相当于调用普通方法。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * @author: 程序员大彬
 * @time: 2021-09-11 10:15
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MyThread</span> mThread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MyThread</span> mThread2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MyThread</span> myThread3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mThread1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mThread2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myThread3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><strong>Runnable 创建线程代码</strong>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * @author: 程序员大彬
 * @time: 2021-09-11 10:04
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunnableTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span>  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Runnable1</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runnable1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;主线程：[&quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Runnable1</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前线程：&quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>实现Runnable接口比继承Thread类所具有的优势：</p> <ol><li>可以避免java中的单继承的限制</li> <li>线程池只能放入实现Runable或Callable类线程，不能直接放入继承Thread的类</li></ol> <p><strong>Callable 创建线程代码</strong>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * @author: 程序员大彬
 * @time: 2021-09-11 10:21
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CallableTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Callable1</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Callable1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//异步计算的结果</span>
        <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//等待任务完成，返回结果</span>
            <span class="token keyword">int</span> sum <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> <span class="token operator">|</span> <span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Callable1</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sum <span class="token operator">+=</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p><strong>使用 Executor 创建线程代码</strong>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * @author: 程序员大彬
 * @time: 2021-09-11 10:44
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExecutorsTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取ExecutorService实例，生产禁用，需要手动创建线程池</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//提交任务</span>
        executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">RunnableDemo</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;大彬&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="什么是线程死锁"><a href="#什么是线程死锁" class="header-anchor">#</a> 什么是线程死锁？</h3> <p>线程死锁是指两个或两个以上的线程在执行过程中，因争夺资源而造成的一种互相等待的现象。若无外力作用，它们都将无法推进下去。</p> <p>如下图所示，线程 A 持有资源 2，线程 B 持有资源 1，他们同时都想申请对方持有的资源，所以这两个线程就会互相等待而进入死锁状态。</p> <p><img src="http://img.dabin-coder.cn/image/%E6%AD%BB%E9%94%81.png" alt="死锁"></p> <p>下面通过例子说明线程死锁，代码来自并发编程之美。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeadLockDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> resource1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//资源 1</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> resource2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//资源 2</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>resource1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;get resource1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;waiting get resource2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>resource2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;get resource2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;线程 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>resource2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;get resource2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;waiting get resource1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>resource1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;get resource1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;线程 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>代码输出如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Thread</span><span class="token punctuation">[</span>线程 <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>main<span class="token punctuation">]</span>get resource1
<span class="token class-name">Thread</span><span class="token punctuation">[</span>线程 <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>main<span class="token punctuation">]</span>get resource2
<span class="token class-name">Thread</span><span class="token punctuation">[</span>线程 <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>main<span class="token punctuation">]</span>waiting get resource2
<span class="token class-name">Thread</span><span class="token punctuation">[</span>线程 <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>main<span class="token punctuation">]</span>waiting get resource1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>线程 A 通过 <code>synchronized</code> (resource1) 获得 resource1 的监视器锁，然后通过 <code>Thread.sleep(1000)</code>。让线程 A 休眠 1s 为的是让线程 B 得到执行然后获取到 resource2 的监视器锁。线程 A 和线程 B 休眠结束了都开始企图请求获取对方的资源，然后这两个线程就会陷入互相等待的状态，这也就产生了死锁。</p> <h3 id="线程死锁怎么产生-怎么避免"><a href="#线程死锁怎么产生-怎么避免" class="header-anchor">#</a> 线程死锁怎么产生？怎么避免？</h3> <p><strong>死锁产生的四个必要条件</strong>：</p> <ul><li><p>互斥：一个资源每次只能被一个进程使用</p></li> <li><p>请求与保持：一个进程因请求资源而阻塞时，不释放获得的资源</p></li> <li><p>不剥夺：进程已获得的资源，在未使用之前，不能强行剥夺</p></li> <li><p>循环等待：进程之间循环等待着资源</p></li></ul> <p><strong>避免死锁的方法</strong>：</p> <ul><li>互斥条件不能破坏，因为加锁就是为了保证互斥</li> <li>一次性申请所有的资源，避免线程占有资源而且在等待其他资源</li> <li>占有部分资源的线程进一步申请其他资源时，如果申请不到，主动释放它占有的资源</li> <li>按序申请资源</li></ul> <h3 id="线程run和start的区别"><a href="#线程run和start的区别" class="header-anchor">#</a> 线程run和start的区别？</h3> <ul><li>当程序调用<code>start()</code>方法，将会创建一个新线程去执行<code>run()</code>方法中的代码。<code>run()</code>就像一个普通方法一样，直接调用<code>run()</code>的话，不会创建新线程。</li> <li>一个线程的 <code>start()</code> 方法只能调用一次，多次调用会抛出 java.lang.IllegalThreadStateException 异常。<code>run()</code> 方法则没有限制。</li></ul> <h3 id="线程都有哪些方法"><a href="#线程都有哪些方法" class="header-anchor">#</a> 线程都有哪些方法？</h3> <p><strong>start</strong></p> <p>用于启动线程。</p> <p><strong>getPriority</strong></p> <p>获取线程优先级，默认是5，线程默认优先级为5，如果不手动指定，那么线程优先级具有继承性，比如线程A启动线程B，那么线程B的优先级和线程A的优先级相同</p> <p><strong>setPriority</strong></p> <p>设置线程优先级。CPU会尽量将执行资源让给优先级比较高的线程。</p> <p><strong>interrupt</strong></p> <p>告诉线程，你应该中断了，具体到底中断还是继续运行，由被通知的线程自己处理。</p> <p>当对一个线程调用 interrupt() 时，有两种情况：</p> <ol><li><p>如果线程处于被阻塞状态（例如处于sleep, wait, join 等状态），那么线程将立即退出被阻塞状态，并抛出一个InterruptedException异常。</p></li> <li><p>如果线程处于正常活动状态，那么会将该线程的中断标志设置为 true。不过，被设置中断标志的线程可以继续正常运行，不受影响。</p></li></ol> <p>interrupt() 并不能真正的中断线程，需要被调用的线程自己进行配合才行。</p> <p><strong>join</strong></p> <p>等待其他线程终止。在当前线程中调用另一个线程的join()方法，则当前线程转入阻塞状态，直到另一个进程运行结束，当前线程再由阻塞转为就绪状态。</p> <p><strong>yield</strong></p> <p>暂停当前正在执行的线程对象，把执行机会让给相同或者更高优先级的线程。</p> <p><strong>sleep</strong></p> <p>使线程转到阻塞状态。millis参数设定睡眠的时间，以毫秒为单位。当睡眠结束后，线程自动转为Runnable状态。</p> <h2 id="volatile底层原理"><a href="#volatile底层原理" class="header-anchor">#</a> volatile底层原理</h2> <p><code>volatile</code>是轻量级的同步机制，<code>volatile</code>保证变量对所有线程的可见性，不保证原子性。</p> <ol><li>当对<code>volatile</code>变量进行写操作的时候，JVM会向处理器发送一条<code>LOCK</code>前缀的指令，将该变量所在缓存行的数据写回系统内存。</li> <li>由于缓存一致性协议，每个处理器通过嗅探在总线上传播的数据来检查自己的缓存是不是过期了，当处理器发现自己缓存行对应的内存地址被修改，就会将当前处理器的缓存行置为无效状态，当处理器对这个数据进行修改操作的时候，会重新从系统内存中把数据读到处理器缓存中。</li></ol> <blockquote><p>来看看缓存一致性协议是什么。</p> <p><strong>缓存一致性协议</strong>：当CPU写数据时，如果发现操作的变量是共享变量，即在其他CPU中也存在该变量的副本，会发出信号通知其他CPU将该变量的缓存行置为无效状态，因此当其他CPU需要读取这个变量时，就会从内存重新读取。</p></blockquote> <p><code>volatile</code>关键字的两个作用：</p> <ol><li>保证了不同线程对共享变量进行操作时的<strong>可见性</strong>，即一个线程修改了某个变量的值，这新值对其他线程来说是立即可见的。</li> <li>禁止进行<strong>指令重排序</strong>。</li></ol> <blockquote><p>指令重排序是JVM为了优化指令，提高程序运行效率，在不影响单线程程序执行结果的前提下，尽可能地提高并行度。Java编译器会在生成指令系列时在适当的位置会插入<code>内存屏障</code>指令来禁止处理器重排序。插入一个内存屏障，相当于告诉CPU和编译器先于这个命令的必须先执行，后于这个命令的必须后执行。对一个volatile字段进行写操作，Java内存模型将在写操作后插入一个写屏障指令，这个指令会把之前的写入值都刷新到内存。</p></blockquote> <h2 id="synchronized的用法有哪些"><a href="#synchronized的用法有哪些" class="header-anchor">#</a> synchronized的用法有哪些?</h2> <ol><li><strong>修饰普通方法</strong>：作用于当前对象实例，进入同步代码前要获得当前对象实例的锁</li> <li><strong>修饰静态方法</strong>：作用于当前类，进入同步代码前要获得当前类对象的锁，synchronized关键字加到static 静态方法和 synchronized(class)代码块上都是是给 Class 类上锁</li> <li><strong>修饰代码块</strong>：指定加锁对象，对给定对象加锁，进入同步代码库前要获得给定对象的锁</li></ol> <h2 id="synchronized的作用有哪些"><a href="#synchronized的作用有哪些" class="header-anchor">#</a> synchronized的作用有哪些？</h2> <p><strong>原子性</strong>：确保线程互斥的访问同步代码；</p> <p><strong>可见性</strong>：保证共享变量的修改能够及时可见；</p> <p><strong>有序性</strong>：有效解决重排序问题。</p> <h2 id="synchronized-底层实现原理"><a href="#synchronized-底层实现原理" class="header-anchor">#</a> synchronized 底层实现原理？</h2> <p>synchronized 同步代码块的实现是通过 <code>monitorenter</code> 和 <code>monitorexit</code> 指令，其中 <code>monitorenter</code> 指令指向同步代码块的开始位置，<code>monitorexit</code> 指令则指明同步代码块的结束位置。当执行 <code>monitorenter</code> 指令时，线程试图获取锁也就是获取 <code>monitor</code>的持有权（monitor对象存在于每个Java对象的对象头中， synchronized 锁便是通过这种方式获取锁的，也是为什么Java中任意对象可以作为锁的原因）。</p> <p>其内部包含一个计数器，当计数器为0则可以成功获取，获取后将锁计数器设为1也就是加1。相应的在执行 <code>monitorexit</code> 指令后，将锁计数器设为0
，表明锁被释放。如果获取对象锁失败，那当前线程就要阻塞等待，直到锁被另外一个线程释放为止</p> <p>synchronized 修饰的方法并没有 <code>monitorenter</code> 指令和 <code>monitorexit</code> 指令，取得代之的确实是<code>ACC_SYNCHRONIZED</code> 标识，该标识指明了该方法是一个同步方法，JVM 通过该 <code>ACC_SYNCHRONIZED</code> 访问标志来辨别一个方法是否声明为同步方法，从而执行相应的同步调用。</p> <h2 id="volatile和synchronized的区别是什么"><a href="#volatile和synchronized的区别是什么" class="header-anchor">#</a> volatile和synchronized的区别是什么？</h2> <ol><li><code>volatile</code>只能使用在变量上；而<code>synchronized</code>可以在类，变量，方法和代码块上。</li> <li><code>volatile</code>至保证可见性；<code>synchronized</code>保证原子性与可见性。</li> <li><code>volatile</code>禁用指令重排序；<code>synchronized</code>不会。</li> <li><code>volatile</code>不会造成阻塞；<code>synchronized</code>会。</li></ol> <h2 id="reentrantlock和synchronized区别"><a href="#reentrantlock和synchronized区别" class="header-anchor">#</a> ReentrantLock和synchronized区别</h2> <ol><li>使用synchronized关键字实现同步，线程执行完同步代码块会<strong>自动释放锁</strong>，而ReentrantLock需要手动释放锁。</li> <li>synchronized是<strong>非公平锁</strong>，ReentrantLock可以设置为公平锁。</li> <li>ReentrantLock上等待获取锁的线程是<strong>可中断的</strong>，线程可以放弃等待锁。而synchonized会无限期等待下去。</li> <li>ReentrantLock <strong>可以设置超时获取锁</strong>。在指定的截止时间之前获取锁，如果截止时间到了还没有获取到锁，则返回。</li> <li>ReentrantLock 的 tryLock() 方法<strong>可以尝试非阻塞的获取锁</strong>，调用该方法后立刻返回，如果能够获取则返回true，否则返回false。</li></ol> <h2 id="wait-和sleep-的异同点"><a href="#wait-和sleep-的异同点" class="header-anchor">#</a> wait()和sleep()的异同点？</h2> <p><strong>相同点</strong>：</p> <ol><li>它们都可以使当前线程暂停运行，把机会交给其他线程</li> <li>任何线程在调用wait()和sleep()之后，在等待期间被中断都会抛出<code>InterruptedException</code></li></ol> <p><strong>不同点</strong>：</p> <ol><li><code>wait()</code>是Object超类中的方法；而<code>sleep()</code>是线程Thread类中的方法</li> <li>对锁的持有不同，<code>wait()</code>会释放锁，而<code>sleep()</code>并不释放锁</li> <li>唤醒方法不完全相同，<code>wait()</code>依靠<code>notify</code>或者<code>notifyAll</code>、中断、达到指定时间来唤醒；而<code>sleep()</code>到达指定时间被唤醒</li> <li>调用<code>wait()</code>需要先获取对象的锁，而<code>Thread.sleep()</code>不用</li></ol> <h2 id="runnable和callable有什么区别"><a href="#runnable和callable有什么区别" class="header-anchor">#</a> Runnable和Callable有什么区别？</h2> <ul><li>Callable接口方法是<code>call()</code>，Runnable的方法是<code>run()</code>；</li> <li>Callable接口call方法有返回值，支持泛型，Runnable接口run方法无返回值。</li> <li>Callable接口<code>call()</code>方法允许抛出异常；而Runnable接口<code>run()</code>方法不能继续上抛异常。</li></ul> <h2 id="线程执行顺序怎么控制"><a href="#线程执行顺序怎么控制" class="header-anchor">#</a> 线程执行顺序怎么控制？</h2> <p>假设有T1、T2、T3三个线程，你怎样保证T2在T1执行完后执行，T3在T2执行完后执行？</p> <p>可以使用<strong>join方法</strong>解决这个问题。比如在线程A中，调用线程B的join方法表示的意思就是**：A等待B线程执行完毕后（释放CPU执行权），在继续执行。**</p> <p>代码如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class ThreadTest {

    public static void main(String[] args) {

        Thread spring = new Thread(new SeasonThreadTask(&quot;春天&quot;));
        Thread summer = new Thread(new SeasonThreadTask(&quot;夏天&quot;));
        Thread autumn = new Thread(new SeasonThreadTask(&quot;秋天&quot;));

        try
        {
            //春天线程先启动
            spring.start();
            //主线程等待线程spring执行完，再往下执行
            spring.join();
            //夏天线程再启动
            summer.start();
            //主线程等待线程summer执行完，再往下执行
            summer.join();
            //秋天线程最后启动
            autumn.start();
            //主线程等待线程autumn执行完，再往下执行
            autumn.join();
        } catch (InterruptedException e)
        {
            e.printStackTrace();
        }
    }
}

class SeasonThreadTask implements Runnable{

    private String name;

    public SeasonThreadTask(String name){
        this.name = name;
    }

    @Override
    public void run() {
        for (int i = 1; i &lt;4; i++) {
            System.out.println(this.name + &quot;来了: &quot; + i + &quot;次&quot;);
            try {
                Thread.sleep(100);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>运行结果：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>春天来了: 1次
春天来了: 2次
春天来了: 3次
夏天来了: 1次
夏天来了: 2次
夏天来了: 3次
秋天来了: 1次
秋天来了: 2次
秋天来了: 3次
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="守护线程是什么"><a href="#守护线程是什么" class="header-anchor">#</a> 守护线程是什么？</h2> <p>守护线程是<strong>运行在后台的一种特殊进程</strong>。它独立于控制终端并且周期性地执行某种任务或等待处理某些发生的事件。在 Java 中垃圾回收线程就是特殊的守护线程。</p> <h2 id="线程间通信方式"><a href="#线程间通信方式" class="header-anchor">#</a> 线程间通信方式</h2> <p><strong>volatile</strong></p> <p><strong>volatile</strong> 使用共享内存实现线程间相互通信。多个线程同时监听一个变量，当这个变量被某一个线程修改的时候，其他线程可以感知到这个变化。</p> <p><strong>wait 和 notify</strong></p> <p><code>wait/notify</code>为Object对象的方法，调用<code>wait/notify</code>需要先获得对象的锁。对象调用<code>wait()</code>之后线程释放锁，将线程放到对象的等待队列，当通知线程调用此对象的<code>notify()</code>方法后，等待线程并不会立即从<code>wait()</code>返回，需要等待通知线程释放锁（通知线程执行完同步代码块），等待队列里的线程获取锁，获取锁成功才能从<code>wait()</code>方法返回，即从<code>wait()</code>方法返回前提是线程获得锁。</p> <p><strong>join</strong></p> <p>当在一个线程调用另一个线程的<code>join()</code>方法时，当前线程阻塞等待被调用join方法的线程执行完毕才能继续执行。<code>join()</code>是基于等待通知机制实现的。</p> <h2 id="threadlocal"><a href="#threadlocal" class="header-anchor">#</a> ThreadLocal</h2> <p>线程本地变量。当使用<code>ThreadLocal</code>维护变量时，<code>ThreadLocal</code>为每个使用该变量的线程提供独立的变量副本，所以每一个线程都可以独立地改变自己的副本，而不会影响其它线程。</p> <h3 id="threadlocal原理"><a href="#threadlocal原理" class="header-anchor">#</a> ThreadLocal原理</h3> <p>每个线程都有一个<code>ThreadLocalMap</code>（<code>ThreadLocal</code>内部类），Map中元素的键为<code>ThreadLocal</code>，而值对应线程的变量副本。</p> <p><img src="http://img.dabin-coder.cn/image/threadlocal.png" alt=""></p> <p>调用<code>threadLocal.set()</code>--&gt;调用<code>getMap(Thread)</code>--&gt;返回当前线程的<code>ThreadLocalMap&lt;ThreadLocal, value&gt;</code>--&gt;<code>map.set(this, value)</code>，this是<code>threadLocal</code>本身。源码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ThreadLocalMap</span> map <span class="token operator">=</span> <span class="token function">getMap</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">createMap</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">ThreadLocalMap</span> <span class="token function">getMap</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> t<span class="token punctuation">.</span>threadLocals<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">createMap</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> t<span class="token punctuation">,</span> <span class="token class-name">T</span> firstValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span>threadLocals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocalMap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> firstValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>调用<code>get()</code>--&gt;调用<code>getMap(Thread)</code>--&gt;返回当前线程的<code>ThreadLocalMap&lt;ThreadLocal, value&gt;</code>--&gt;<code>map.getEntry(this)</code>，返回<code>value</code>。源码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ThreadLocalMap</span> map <span class="token operator">=</span> <span class="token function">getMap</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ThreadLocalMap<span class="token punctuation">.</span>Entry</span> e <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
                <span class="token class-name">T</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span>e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
                <span class="token keyword">return</span> result<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">setInitialValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>threadLocals</code>的类型<code>ThreadLocalMap</code>的键为<code>ThreadLocal</code>对象，因为每个线程中可有多个<code>threadLocal</code>变量，如<code>longLocal</code>和<code>stringLocal</code>。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class ThreadLocalDemo {
    ThreadLocal&lt;Long&gt; longLocal = new ThreadLocal&lt;&gt;();

    public void set() {
        longLocal.set(Thread.currentThread().getId());
    }
    public Long get() {
        return longLocal.get();
    }

    public static void main(String[] args) throws InterruptedException {
        ThreadLocalDemo threadLocalDemo = new ThreadLocalDemo();
        threadLocalDemo.set();
        System.out.println(threadLocalDemo.get());

        Thread thread = new Thread(() -&gt; {
            threadLocalDemo.set();
            System.out.println(threadLocalDemo.get());
        }
        );

        thread.start();
        thread.join();

        System.out.println(threadLocalDemo.get());
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><code>ThreadLocal</code>并不是用来解决共享资源的多线程访问问题，因为每个线程中的资源只是副本，不会共享。因此<code>ThreadLocal</code>适合作为线程上下文变量，简化线程内传参。</p> <h3 id="threadlocal内存泄漏的原因"><a href="#threadlocal内存泄漏的原因" class="header-anchor">#</a> ThreadLocal内存泄漏的原因？</h3> <p>每个线程都有⼀个<code>ThreadLocalMap</code>的内部属性，map的key是<code>ThreaLocal</code>，定义为弱引用，value是强引用类型。垃圾回收的时候会⾃动回收key，而value的回收取决于Thread对象的生命周期。一般会通过线程池的方式复用线程节省资源，这也就导致了线程对象的生命周期比较长，这样便一直存在一条强引用链的关系：<code>Thread</code> --&gt; <code>ThreadLocalMap</code>--&gt;<code>Entry</code>--&gt;<code>Value</code>，随着任务的执行，value就有可能越来越多且无法释放，最终导致内存泄漏。</p> <p>解决⽅法：每次使⽤完<code>ThreadLocal</code>就调⽤它的<code>remove()</code>⽅法，手动将对应的键值对删除，从⽽避免内存泄漏。</p> <h3 id="threadlocal使用场景有哪些"><a href="#threadlocal使用场景有哪些" class="header-anchor">#</a> ThreadLocal使用场景有哪些？</h3> <p><code>ThreadLocal</code>适用场景：每个线程需要有自己单独的实例，且需要在多个方法中共享实例，即同时满足实例在线程间的隔离与方法间的共享，这种情况适合使用<code>ThreadLocal</code>。比如Java web应用中，每个线程有自己单独的<code>Session</code>实例，就可以使用<code>ThreadLocal</code>来实现。</p> <h2 id="aqs原理"><a href="#aqs原理" class="header-anchor">#</a> AQS原理</h2> <p>AQS，<code>AbstractQueuedSynchronizer</code>，抽象队列同步器，定义了一套多线程访问共享资源的同步器框架，许多并发工具的实现都依赖于它，如常用的<code>ReentrantLock/Semaphore/CountDownLatch</code>。</p> <p>AQS使用一个<code>volatile</code>的int类型的成员变量<code>state</code>来表示同步状态，通过CAS修改同步状态的值。当线程调用 lock 方法时 ，如果 <code>state</code>=0，说明没有任何线程占有共享资源的锁，可以获得锁并将 <code>state</code>加1。如果 <code>state</code>不为0，则说明有线程目前正在使用共享变量，其他线程必须加入同步队列进行等待。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> state<span class="token punctuation">;</span><span class="token comment">//共享变量，使用volatile修饰保证线程可见性</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>同步器依赖内部的同步队列（一个FIFO双向队列）来完成同步状态的管理，当前线程获取同步状态失败时，同步器会将当前线程以及等待状态（独占或共享 ）构造成为一个节点（Node）并将其加入同步队列并进行自旋，当同步状态释放时，会把首节点中的后继节点对应的线程唤醒，使其再次尝试获取同步状态。</p> <p><img src="http://img.dabin-coder.cn/image/aqs.png" alt=""></p> <h2 id="reentrantlock-是如何实现可重入性的"><a href="#reentrantlock-是如何实现可重入性的" class="header-anchor">#</a> ReentrantLock 是如何实现可重入性的?</h2> <p><code>ReentrantLock</code>内部自定义了同步器sync，在加锁的时候通过CAS算法，将线程对象放到一个双向链表中，每次获取锁的时候，检查当前维护的那个线程ID和当前请求的线程ID是否 一致，如果一致，同步状态加1，表示锁被当前线程获取了多次。</p> <p>源码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">nonfairTryAcquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> acquires<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> acquires<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">==</span> <span class="token function">getExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> nextc <span class="token operator">=</span> c <span class="token operator">+</span> acquires<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nextc <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// overflow</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Maximum lock count exceeded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setState</span><span class="token punctuation">(</span>nextc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="锁的分类"><a href="#锁的分类" class="header-anchor">#</a> 锁的分类</h2> <h3 id="公平锁与非公平锁"><a href="#公平锁与非公平锁" class="header-anchor">#</a> 公平锁与非公平锁</h3> <p>按照<strong>线程访问顺序</strong>获取对象锁。<code>synchronized</code>是非公平锁，<code>Lock</code>默认是非公平锁，可以设置为公平锁，公平锁会影响性能。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sync <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NonfairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> fair<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sync <span class="token operator">=</span> fair <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">FairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">NonfairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="共享式与独占式锁"><a href="#共享式与独占式锁" class="header-anchor">#</a> 共享式与独占式锁</h3> <p>共享式与独占式的最主要<strong>区别</strong>在于：同一时刻独占式只能有<strong>一个线程</strong>获取同步状态，而共享式在同一时刻可以有多个线程获取同步状态。例如读操作可以有多个线程同时进行，而写操作同一时刻只能有一个线程进行写操作，其他操作都会被阻塞。</p> <h3 id="悲观锁与乐观锁"><a href="#悲观锁与乐观锁" class="header-anchor">#</a> 悲观锁与乐观锁</h3> <p>悲观锁，<strong>每次访问资源都会加锁</strong>，执行完同步代码释放锁，<code>synchronized</code>和<code>ReentrantLock</code>属于悲观锁。</p> <p>乐观锁，不会锁定资源，所有的线程都能访问并修改同一个资源，如果没有冲突就修改成功并退出，否则就会继续循环尝试。乐观锁最常见的实现就是<code>CAS</code>。</p> <p>适用场景：</p> <ul><li>悲观锁适合<strong>写操作多</strong>的场景。</li> <li>乐观锁适合<strong>读操作多</strong>的场景，不加锁可以提升读操作的性能。</li></ul> <h2 id="乐观锁有什么问题"><a href="#乐观锁有什么问题" class="header-anchor">#</a> 乐观锁有什么问题?</h2> <p>乐观锁避免了悲观锁独占对象的问题，提高了并发性能，但它也有缺点:</p> <ul><li>乐观锁只能保证<strong>一个共享变量</strong>的原子操作。</li> <li>长时间自旋可能导致<strong>开销大</strong>。假如CAS长时间不成功而一直自旋，会给CPU带来很大的开销。</li> <li><strong>ABA问题</strong>。CAS的原理是通过比对内存值与预期值是否一样而判断内存值是否被改过，但是会有以下问题：假如内存值原来是A， 后来被一条线程改为B，最后又被改成了A，则CAS认为此内存值并没有发生改变。可以引入版本号解决这个问题，每次变量更新都把版本号加一。</li></ul> <h2 id="什么是cas"><a href="#什么是cas" class="header-anchor">#</a> 什么是CAS？</h2> <p>CAS全称<code>Compare And Swap</code>，比较与交换，是乐观锁的主要实现方式。CAS在不使用锁的情况下实现多线程之间的变量同步。<code>ReentrantLock</code>内部的AQS和原子类内部都使用了CAS。</p> <p>CAS算法涉及到三个操作数：</p> <ul><li>需要读写的内存值V。</li> <li>进行比较的值A。</li> <li>要写入的新值B。</li></ul> <p>只有当V的值等于A时，才会使用原子方式用新值B来更新V的值，否则会继续重试直到成功更新值。</p> <p>以<code>AtomicInteger</code>为例，<code>AtomicInteger</code>的<code>getAndIncrement()</code>方法底层就是CAS实现，关键代码是 <code>compareAndSwapInt(obj, offset, expect, update)</code>，其含义就是，如果<code>obj</code>内的<code>value</code>和<code>expect</code>相等，就证明没有其他线程改变过这个变量，那么就更新它为<code>update</code>，如果不相等，那就会继续重试直到成功更新值。</p> <h2 id="cas存在的问题"><a href="#cas存在的问题" class="header-anchor">#</a> CAS存在的问题？</h2> <p>CAS 三大问题：</p> <ol><li><p><strong>ABA问题</strong>。CAS需要在操作值的时候检查内存值是否发生变化，没有发生变化才会更新内存值。但是如果内存值原来是A，后来变成了B，然后又变成了A，那么CAS进行检查时会发现值没有发生变化，但是实际上是有变化的。ABA问题的解决思路就是在变量前面添加版本号，每次变量更新的时候都把版本号加一，这样变化过程就从<code>A－B－A</code>变成了<code>1A－2B－3A</code>。</p> <p>JDK从1.5开始提供了AtomicStampedReference类来解决ABA问题，原子更新带有版本号的引用类型。</p></li> <li><p><strong>循环时间长开销大</strong>。CAS操作如果长时间不成功，会导致其一直自旋，给CPU带来非常大的开销。</p></li> <li><p><strong>只能保证一个共享变量的原子操作</strong>。对一个共享变量执行操作时，CAS能够保证原子操作，但是对多个共享变量操作时，CAS是无法保证操作的原子性的。</p> <p>Java从1.5开始JDK提供了AtomicReference类来保证引用对象之间的原子性，可以把多个变量放在一个对象里来进行CAS操作。</p></li></ol> <h2 id="并发工具"><a href="#并发工具" class="header-anchor">#</a> 并发工具</h2> <p>在JDK的并发包里提供了几个非常有用的并发工具类。CountDownLatch、CyclicBarrier和Semaphore工具类提供了一种并发流程控制的手段。</p> <h3 id="countdownlatch"><a href="#countdownlatch" class="header-anchor">#</a> CountDownLatch</h3> <p>CountDownLatch用于某个线程等待其他线程<strong>执行完任务</strong>再执行，与thread.join()功能类似。常见的应用场景是开启多个线程同时执行某个任务，等到所有任务执行完再执行特定操作，如汇总统计结果。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class CountDownLatchDemo {
    static final int N = 4;
    static CountDownLatch latch = new CountDownLatch(N);

    public static void main(String[] args) throws InterruptedException {

       for(int i = 0; i &lt; N; i++) {
            new Thread(new Thread1()).start();
       }

       latch.await(1000, TimeUnit.MILLISECONDS); //调用await()方法的线程会被挂起，它会等待直到count值为0才继续执行;等待timeout时间后count值还没变为0的话就会继续执行
       System.out.println(&quot;task finished&quot;);
    }

    static class Thread1 implements Runnable {

        @Override
        public void run() {
            try {
                System.out.println(Thread.currentThread().getName() + &quot;starts working&quot;);
                Thread.sleep(1000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            } finally {
                latch.countDown();
            }
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>运行结果：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">0</span>starts working
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">1</span>starts working
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">2</span>starts working
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">3</span>starts working
task finished
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="cyclicbarrier"><a href="#cyclicbarrier" class="header-anchor">#</a> CyclicBarrier</h3> <p>CyclicBarrier(同步屏障)，用于一组线程互相等待到某个状态，然后这组线程再<strong>同时</strong>执行。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token keyword">int</span> parties<span class="token punctuation">,</span> <span class="token class-name">Runnable</span> barrierAction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token keyword">int</span> parties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数parties指让多少个线程或者任务等待至某个状态；参数barrierAction为当这些线程都达到某个状态时会执行的内容。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CyclicBarrierTest</span> <span class="token punctuation">{</span>
    <span class="token comment">// 请求的数量</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> threadCount <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token comment">// 需要同步的线程数量</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建线程池</span>
        <span class="token class-name">ExecutorService</span> threadPool <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> threadCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> threadNum <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            threadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token function">test</span><span class="token punctuation">(</span>threadNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// TODO Auto-generated catch block</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// TODO Auto-generated catch block</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        threadPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">int</span> threadnum<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">BrokenBarrierException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;threadnum:&quot;</span> <span class="token operator">+</span> threadnum <span class="token operator">+</span> <span class="token string">&quot;is ready&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">/**等待60秒，保证子线程完全执行结束*/</span>
            cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----CyclicBarrierException------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;threadnum:&quot;</span> <span class="token operator">+</span> threadnum <span class="token operator">+</span> <span class="token string">&quot;is finish&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>运行结果如下，可以看出CyclicBarrier是可以重用的：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>threadnum<span class="token operator">:</span><span class="token number">0</span>is ready
threadnum<span class="token operator">:</span><span class="token number">1</span>is ready
threadnum<span class="token operator">:</span><span class="token number">2</span>is ready
threadnum<span class="token operator">:</span><span class="token number">3</span>is ready
threadnum<span class="token operator">:</span><span class="token number">4</span>is ready
threadnum<span class="token operator">:</span><span class="token number">4</span>is finish
threadnum<span class="token operator">:</span><span class="token number">3</span>is finish
threadnum<span class="token operator">:</span><span class="token number">2</span>is finish
threadnum<span class="token operator">:</span><span class="token number">1</span>is finish
threadnum<span class="token operator">:</span><span class="token number">0</span>is finish
threadnum<span class="token operator">:</span><span class="token number">5</span>is ready
threadnum<span class="token operator">:</span><span class="token number">6</span>is ready
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>当四个线程都到达barrier状态后，会从四个线程中选择一个线程去执行Runnable。</p> <h3 id="cyclicbarrier和countdownlatch区别"><a href="#cyclicbarrier和countdownlatch区别" class="header-anchor">#</a> CyclicBarrier和CountDownLatch区别</h3> <p>CyclicBarrier 和 CountDownLatch 都能够实现线程之间的等待。</p> <p>CountDownLatch用于某个线程等待其他线程<strong>执行完任务</strong>再执行。CyclicBarrier用于一组线程互相等待到某个状态，然后这组线程再<strong>同时</strong>执行。
CountDownLatch的计数器只能使用一次，而CyclicBarrier的计数器可以使用reset()方法重置，可用于处理更为复杂的业务场景。</p> <h3 id="semaphore"><a href="#semaphore" class="header-anchor">#</a> Semaphore</h3> <p>Semaphore类似于锁，它用于控制同时访问特定资源的线程数量，控制并发线程数。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class SemaphoreDemo {
    public static void main(String[] args) {
        final int N = 7;
        Semaphore s = new Semaphore(3);
        for(int i = 0; i &lt; N; i++) {
            new Worker(s, i).start();
        }
    }

    static class Worker extends Thread {
        private Semaphore s;
        private int num;
        public Worker(Semaphore s, int num) {
            this.s = s;
            this.num = num;
        }

        @Override
        public void run() {
            try {
                s.acquire();
                System.out.println(&quot;worker&quot; + num +  &quot; using the machine&quot;);
                Thread.sleep(1000);
                System.out.println(&quot;worker&quot; + num +  &quot; finished the task&quot;);
                s.release();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>运行结果如下，可以看出并非按照线程访问顺序获取资源的锁，即</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>worker0 using the machine
worker1 using the machine
worker2 using the machine
worker2 finished the task
worker0 finished the task
worker3 using the machine
worker4 using the machine
worker1 finished the task
worker6 using the machine
worker4 finished the task
worker3 finished the task
worker6 finished the task
worker5 using the machine
worker5 finished the task
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="原子类"><a href="#原子类" class="header-anchor">#</a> 原子类</h2> <h3 id="基本类型原子类"><a href="#基本类型原子类" class="header-anchor">#</a> 基本类型原子类</h3> <p>使用原子的方式更新基本类型</p> <ul><li>AtomicInteger：整型原子类</li> <li>AtomicLong：长整型原子类</li> <li>AtomicBoolean ：布尔型原子类</li></ul> <p>AtomicInteger 类常用的方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//获取当前的值</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> newValue<span class="token punctuation">)</span><span class="token comment">//获取当前的值，并设置新的值</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//获取当前的值，并自增</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndDecrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//获取当前的值，并自减</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndAdd</span><span class="token punctuation">(</span><span class="token keyword">int</span> delta<span class="token punctuation">)</span> <span class="token comment">//获取当前的值，并加上预期的值</span>
<span class="token keyword">boolean</span> <span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> expect<span class="token punctuation">,</span> <span class="token keyword">int</span> update<span class="token punctuation">)</span> <span class="token comment">//如果输入的数值等于预期值，则以原子方式将该值设置为输入值（update）</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">lazySet</span><span class="token punctuation">(</span><span class="token keyword">int</span> newValue<span class="token punctuation">)</span><span class="token comment">//最终设置为newValue,使用 lazySet 设置之后可能导致其他线程在之后的一小段时间内还是可以读到旧的值。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>AtomicInteger 类主要利用 CAS (compare and swap) 保证原子操作，从而避免加锁的高开销。</p> <h3 id="数组类型原子类"><a href="#数组类型原子类" class="header-anchor">#</a> 数组类型原子类</h3> <p>使用原子的方式更新数组里的某个元素</p> <ul><li>AtomicIntegerArray：整形数组原子类</li> <li>AtomicLongArray：长整形数组原子类</li> <li>AtomicReferenceArray ：引用类型数组原子类</li></ul> <p>AtomicIntegerArray 类常用方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token comment">//获取 index=i 位置元素的值</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> newValue<span class="token punctuation">)</span><span class="token comment">//返回 index=i 位置的当前的值，并将其设置为新值：newValue</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span><span class="token comment">//获取 index=i 位置元素的值，并让该位置的元素自增</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndDecrement</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token comment">//获取 index=i 位置元素的值，并让该位置的元素自减</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndAdd</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> delta<span class="token punctuation">)</span> <span class="token comment">//获取 index=i 位置元素的值，并加上预期的值</span>
<span class="token keyword">boolean</span> <span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> expect<span class="token punctuation">,</span> <span class="token keyword">int</span> update<span class="token punctuation">)</span> <span class="token comment">//如果输入的数值等于预期值，则以原子方式将 index=i 位置的元素值设置为输入值（update）</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">lazySet</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> newValue<span class="token punctuation">)</span><span class="token comment">//最终 将index=i 位置的元素设置为newValue,使用 lazySet 设置之后可能导致其他线程在之后的一小段时间内还是可以读到旧的值。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="引用类型原子类"><a href="#引用类型原子类" class="header-anchor">#</a> 引用类型原子类</h3> <ul><li>AtomicReference：引用类型原子类</li> <li>AtomicStampedReference：带有版本号的引用类型原子类。该类将整数值与引用关联起来，可用于解决原子的更新数据和数据的版本号，可以解决使用 CAS 进行原子更新时可能出现的 ABA 问题。</li> <li>AtomicMarkableReference ：原子更新带有标记的引用类型。该类将 boolean 标记与引用关联起来</li></ul> <h2 id="为什么要使用executor线程池框架呢"><a href="#为什么要使用executor线程池框架呢" class="header-anchor">#</a> 为什么要使用Executor线程池框架呢？</h2> <ul><li>每次执行任务都通过new Thread()去创建线程，比较消耗性能，创建一个线程是比较耗时、耗资源的</li> <li>调用new Thread()创建的线程缺乏管理，可以无限制的创建，线程之间的相互竞争会导致过多占用系统资源而导致系统瘫痪</li> <li>直接使用new Thread()启动的线程不利于扩展，比如定时执行、定期执行、定时定期执行、线程中断等都不好实现</li></ul> <h2 id="如何停止一个正在运行的线程"><a href="#如何停止一个正在运行的线程" class="header-anchor">#</a> 如何停止一个正在运行的线程？</h2> <ol><li>使用共享变量的方式。共享变量可以被多个执行相同任务的线程用来作为是否停止的信号，通知停止线程的执行。</li> <li>使用interrupt方法终止线程。当一个线程被阻塞，处于不可运行状态时，即使主程序中将该线程的共享变量设置为true，但该线程此时根本无法检查循环标志，当然也就无法立即中断。这时候可以使用Thread提供的interrupt()方法，因为该方法虽然不会中断一个正在运行的线程，但是它可以使一个被阻塞的线程抛出一个中断异常，从而使线程提前结束阻塞状态。</li></ol> <h2 id="什么是daemon线程"><a href="#什么是daemon线程" class="header-anchor">#</a> 什么是Daemon线程？</h2> <p>后台(daemon)线程，是指在程序运行的时候在后台提供一种通用服务的线程，并且这个线程并不属于程序中不可或缺的部分。因此，当所有的非后台线程结束时，程序也就终止了，同时会杀死进程中的所有后台线程。反过来说，只要有任何非后台线程还在运行，程序就不会终止。必须在线程启动之前调用setDaemon()方法，才能把它设置为后台线程。</p> <p>注意：后台进程在不执行finally子句的情况下就会终止其run()方法。</p> <p>比如：JVM的垃圾回收线程就是Daemon线程，Finalizer也是守护线程。</p> <h2 id="synchronizedmap和concurrenthashmap有什么区别"><a href="#synchronizedmap和concurrenthashmap有什么区别" class="header-anchor">#</a> SynchronizedMap和ConcurrentHashMap有什么区别？</h2> <p>SynchronizedMap一次锁住整张表来保证线程安全，所以每次只能有一个线程来访问map。</p> <p>JDK1.8 ConcurrentHashMap采用CAS和synchronized来保证并发安全。数据结构采用数组+链表/红黑二叉树。synchronized只锁定当前链表或红黑二叉树的首节点，支持并发访问、修改。
另外ConcurrentHashMap使用了一种不同的迭代方式。当iterator被创建后集合再发生改变就不再是抛出ConcurrentModificationException，取而代之的是在改变时new新的数据从而不影响原有的数据 ，iterator完成后再将头指针替换为新的数据 ，这样iterator线程可以使用原来老的数据，而写线程也可以并发的完成改变。</p> <h2 id="怎么判断线程池的任务是不是执行完了"><a href="#怎么判断线程池的任务是不是执行完了" class="header-anchor">#</a> 怎么判断线程池的任务是不是执行完了？</h2> <p>有几种方法：</p> <p>1、使用线程池的原生函数<strong>isTerminated()</strong>;</p> <p>executor提供一个原生函数isTerminated()来判断线程池中的任务是否全部完成。如果全部完成返回true，否则返回false。</p> <p>2、<strong>使用重入锁，维持一个公共计数</strong>。</p> <p>所有的普通任务维持一个计数器，当任务完成时计数器加一（这里要加锁），当计数器的值等于任务数时，这时所有的任务已经执行完毕了。</p> <p>3、<strong>使用CountDownLatch</strong>。</p> <p>它的原理跟第二种方法类似，给CountDownLatch一个计数值，任务执行完毕后，调用countDown()执行计数值减一。最后执行的任务在调用方法的开始调用await()方法，这样整个任务会阻塞，直到这个计数值为零，才会继续执行。</p> <p>这种方式的<strong>缺点</strong>就是需要提前知道任务的数量。</p> <p>4、<strong>submit向线程池提交任务，使用Future判断任务执行状态</strong>。</p> <p>使用submit向线程池提交任务与execute提交不同，submit会有Future类型的返回值。通过future.isDone()方法可以知道任务是否执行完成。</p> <p><img src="http://img.dabin-coder.cn/image/20220612101342.png" alt=""></p></div> <div class="page-edit"><!----> <span class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/3/2022, 11:19:09 PM</span></span></div> <!----> <!----> </main> <!----></div><div class="global-ui"><div></div><div class="qrcode_container" data-v-131437c0><div class="tencent_code" data-v-131437c0><h4 data-v-131437c0>关注作者公众号</h4> <p data-v-131437c0>和万千小伙伴一起学习</p> <img src="/assets/img/gzh.375c9530.jpg" alt data-v-131437c0></div> <div class="group_code" data-v-131437c0><h4 data-v-131437c0>加入技术交流群</h4> <p data-v-131437c0>扫描二维码 备注<span data-v-131437c0> 技术群</span></p> <img src="/assets/img/wechat.d205276b.jpg" alt data-v-131437c0></div></div><!----><div></div></div></div>
    <script src="/assets/js/app.8b2696d1.js" defer></script><script src="/assets/js/2.d0db0f62.js" defer></script><script src="/assets/js/51.0cbece85.js" defer></script><script src="/assets/js/4.23f6297f.js" defer></script><script src="/assets/js/3.1924df35.js" defer></script>
  </body>
</html>
